/*
 Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Copyright 2011, Tim Down
 Licensed under the MIT license.
 Version: 1.2.2
 Build date: 13 November 2011
 Selection save and restore module for Rangy.
 Saves and restores user selections using marker invisible elements in the DOM.

 Part of Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Depends on Rangy core.

 Copyright 2011, Tim Down
 Licensed under the MIT license.
 Version: 1.2.2
 Build date: 13 November 2011
*/
"undefined"===typeof WYMeditor&&(WYMeditor={});(function(){if("undefined"===typeof window.console&&"undefined"===typeof console){var a="log debug info warn error assert dir dirxml group groupEnd time timeEnd count trace profile profileEnd".split(" "),b=function(){},c;WYMeditor.console={};for(c=0;c<a.length;c+=1)WYMeditor.console[a[c]]=b}else console?WYMeditor.console=console:window.console.firebug?WYMeditor.console=window.console:window.console&&(WYMeditor.console=window.console)})();
jQuery.extend(WYMeditor,{VERSION:"1.0.0b3",INSTANCES:[],STRINGS:[],SKINS:[],NAME:"name",INDEX:"{Wym_Index}",WYM_INDEX:"wym_index",BASE_PATH:"{Wym_Base_Path}",CSS_PATH:"{Wym_Css_Path}",WYM_PATH:"{Wym_Wym_Path}",SKINS_DEFAULT_PATH:"skins/",SKINS_DEFAULT_CSS:"skin.css",SKINS_DEFAULT_JS:"skin.js",LANG_DEFAULT_PATH:"lang/",IFRAME_BASE_PATH:"{Wym_Iframe_Base_Path}",IFRAME_DEFAULT:"iframe/default/",JQUERY_PATH:"{Wym_Jquery_Path}",DIRECTION:"{Wym_Direction}",LOGO:"{Wym_Logo}",TOOLS:"{Wym_Tools}",TOOLS_ITEMS:"{Wym_Tools_Items}",
TOOL_NAME:"{Wym_Tool_Name}",TOOL_TITLE:"{Wym_Tool_Title}",TOOL_CLASS:"{Wym_Tool_Class}",CLASSES:"{Wym_Classes}",CLASSES_ITEMS:"{Wym_Classes_Items}",CLASS_NAME:"{Wym_Class_Name}",CLASS_TITLE:"{Wym_Class_Title}",CONTAINERS:"{Wym_Containers}",CONTAINERS_ITEMS:"{Wym_Containers_Items}",CONTAINER_NAME:"{Wym_Container_Name}",CONTAINER_TITLE:"{Wym_Containers_Title}",CONTAINER_CLASS:"{Wym_Container_Class}",HTML:"{Wym_Html}",IFRAME:"{Wym_Iframe}",STATUS:"{Wym_Status}",DIALOG_TITLE:"{Wym_Dialog_Title}",DIALOG_BODY:"{Wym_Dialog_Body}",
NEWLINE:"\n",STRING:"string",BODY:"body",DIV:"div",P:"p",H1:"h1",H2:"h2",H3:"h3",H4:"h4",H5:"h5",H6:"h6",PRE:"pre",BLOCKQUOTE:"blockquote",A:"a",BR:"br",IMG:"img",TABLE:"table",TR:"tr",TD:"td",TH:"th",UL:"ul",OL:"ol",LI:"li",CLASS:"class",HREF:"href",SRC:"src",TITLE:"title",REL:"rel",ALT:"alt",DIALOG_LINK:"Link",DIALOG_IMAGE:"Image",DIALOG_TABLE:"Table",DIALOG_PASTE:"Paste_From_Word",BOLD:"Bold",ITALIC:"Italic",CREATE_LINK:"CreateLink",INSERT_IMAGE:"InsertImage",INSERT_TABLE:"InsertTable",INSERT_HTML:"InsertHTML",
PASTE:"Paste",INDENT:"Indent",OUTDENT:"Outdent",TOGGLE_HTML:"ToggleHtml",FORMAT_BLOCK:"FormatBlock",PREVIEW:"Preview",UNLINK:"Unlink",INSERT_UNORDEREDLIST:"InsertUnorderedList",INSERT_ORDEREDLIST:"InsertOrderedList",MAIN_CONTAINERS:"p h1 h2 h3 h4 h5 h6 pre blockquote".split(" "),BLOCKS:"address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr noscript ol p pre table ul dd dt li tbody td tfoot th thead tr meter section article aside details header footer nav dialog figure figcaption address hgroup mark time canvas audio video source output progress ruby rt rp summary command".split(" "),
BLOCKING_ELEMENTS:["table","blockquote","pre"],NON_BLOCKING_ELEMENTS:"p h1 h2 h3 h4 h5 h6".split(" "),POTENTIAL_LIST_ELEMENTS:"p h1 h2 h3 h4 h5 h6 pre blockquote td".split(" "),KEY:{BACKSPACE:8,TAB:9,ENTER:13,CTRL:17,END:35,HOME:36,CURSOR:[37,38,39,40],LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,B:66,I:73,R:82,COMMAND:224},NODE:{ELEMENT:1,ATTRIBUTE:2,TEXT:3},editor:function(a,b){this._index=WYMeditor.INSTANCES.push(this)-1;this._element=a;this._options=b;this._html=jQuery(a).val();this._options.html&&
(this._html=this._options.html);this._options.wymPath=this._options.wymPath||WYMeditor.computeWymPath();this._options.basePath=this._options.basePath||WYMeditor.computeBasePath(this._options.wymPath);this._options.jQueryPath=this._options.jQueryPath||WYMeditor.computeJqueryPath();this._options.skinPath=this._options.skinPath||this._options.basePath+WYMeditor.SKINS_DEFAULT_PATH+this._options.skin+"/";this._options.langPath=this._options.langPath||this._options.basePath+WYMeditor.LANG_DEFAULT_PATH;
this._options.iframeBasePath=this._options.iframeBasePath||this._options.basePath+WYMeditor.IFRAME_DEFAULT;this.init()}});
jQuery.fn.wymeditor=function(a){a=jQuery.extend({html:"",basePath:!1,skinPath:!1,wymPath:!1,iframeBasePath:!1,jQueryPath:!1,styles:!1,stylesheet:!1,skin:"default",initSkin:!0,loadSkin:!0,lang:"en",direction:"ltr",customCommands:[],boxHtml:String()+"<div class='wym_box'><div class='wym_area_top'>"+WYMeditor.TOOLS+"</div><div class='wym_area_left'></div><div class='wym_area_right'>"+WYMeditor.CONTAINERS+WYMeditor.CLASSES+"</div><div class='wym_area_main'>"+WYMeditor.HTML+WYMeditor.IFRAME+WYMeditor.STATUS+
"</div><div class='wym_area_bottom'>"+WYMeditor.LOGO+"</div></div>",logoHtml:String()+'<a class="wym_wymeditor_link" href="http://www.wymeditor.org/">WYMeditor</a>',iframeHtml:String()+'<div class="wym_iframe wym_section"><iframe src="'+WYMeditor.IFRAME_BASE_PATH+'wymiframe.html" onload="this.contentWindow.parent.WYMeditor.INSTANCES['+WYMeditor.INDEX+'].initIframe(this)"></iframe></div>',editorStyles:[],toolsHtml:String()+'<div class="wym_tools wym_section"><h2>{Tools}</h2><ul>'+WYMeditor.TOOLS_ITEMS+
"</ul></div>",toolsItemHtml:String()+'<li class="'+WYMeditor.TOOL_CLASS+'"><a href="#" name="'+WYMeditor.TOOL_NAME+'" title="'+WYMeditor.TOOL_TITLE+'">'+WYMeditor.TOOL_TITLE+"</a></li>",toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:"Superscript",css:"wym_tools_superscript"},{name:"Subscript",title:"Subscript",css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},
{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"},
{name:"Paste",title:"Paste_From_Word",css:"wym_tools_paste"},{name:"ToggleHtml",title:"HTML",css:"wym_tools_html"},{name:"Preview",title:"Preview",css:"wym_tools_preview"}],containersHtml:String()+'<div class="wym_containers wym_section"><h2>{Containers}</h2><ul>'+WYMeditor.CONTAINERS_ITEMS+"</ul></div>",containersItemHtml:String()+'<li class="'+WYMeditor.CONTAINER_CLASS+'"><a href="#" name="'+WYMeditor.CONTAINER_NAME+'">'+WYMeditor.CONTAINER_TITLE+"</a></li>",containersItems:[{name:"P",title:"Paragraph",
css:"wym_containers_p"},{name:"H1",title:"Heading_1",css:"wym_containers_h1"},{name:"H2",title:"Heading_2",css:"wym_containers_h2"},{name:"H3",title:"Heading_3",css:"wym_containers_h3"},{name:"H4",title:"Heading_4",css:"wym_containers_h4"},{name:"H5",title:"Heading_5",css:"wym_containers_h5"},{name:"H6",title:"Heading_6",css:"wym_containers_h6"},{name:"PRE",title:"Preformatted",css:"wym_containers_pre"},{name:"BLOCKQUOTE",title:"Blockquote",css:"wym_containers_blockquote"},{name:"TH",title:"Table_Header",
css:"wym_containers_th"}],classesHtml:String()+'<div class="wym_classes wym_section"><h2>{Classes}</h2><ul>'+WYMeditor.CLASSES_ITEMS+"</ul></div>",classesItemHtml:String()+'<li class="wym_classes_'+WYMeditor.CLASS_NAME+'"><a href="#" name="'+WYMeditor.CLASS_NAME+'">'+WYMeditor.CLASS_TITLE+"</a></li>",classesItems:[],statusHtml:String()+'<div class="wym_status wym_section"><h2>{Status}</h2></div>',htmlHtml:String()+'<div class="wym_html wym_section"><h2>{Source_Code}</h2><textarea class="wym_html_val"></textarea></div>',
boxSelector:".wym_box",toolsSelector:".wym_tools",toolsListSelector:" ul",containersSelector:".wym_containers",classesSelector:".wym_classes",htmlSelector:".wym_html",iframeSelector:".wym_iframe iframe",iframeBodySelector:".wym_iframe",statusSelector:".wym_status",toolSelector:".wym_tools a",containerSelector:".wym_containers a",classSelector:".wym_classes a",htmlValSelector:".wym_html_val",hrefSelector:".wym_href",srcSelector:".wym_src",titleSelector:".wym_title",relSelector:".wym_rel",altSelector:".wym_alt",
textSelector:".wym_text",rowsSelector:".wym_rows",colsSelector:".wym_cols",captionSelector:".wym_caption",summarySelector:".wym_summary",submitSelector:"form",cancelSelector:".wym_cancel",previewSelector:"",dialogTypeSelector:".wym_dialog_type",dialogLinkSelector:".wym_dialog_link",dialogImageSelector:".wym_dialog_image",dialogTableSelector:".wym_dialog_table",dialogPasteSelector:".wym_dialog_paste",dialogPreviewSelector:".wym_dialog_preview",updateSelector:".wymupdate",updateEvent:"click",dialogFeatures:"menubar=no,titlebar=no,toolbar=no,resizable=no,width=560,height=300,top=0,left=0",
dialogFeaturesPreview:"menubar=no,titlebar=no,toolbar=no,resizable=no,scrollbars=yes,width=560,height=300,top=0,left=0",dialogHtml:String()+'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html dir="'+WYMeditor.DIRECTION+'"><head><link rel="stylesheet" type="text/css" media="screen" href="'+WYMeditor.CSS_PATH+'" /><title>'+WYMeditor.DIALOG_TITLE+'</title><script type="text/javascript" src="'+WYMeditor.JQUERY_PATH+'"><\/script><script type="text/javascript" src="'+
WYMeditor.WYM_PATH+'"><\/script></head>'+WYMeditor.DIALOG_BODY+"</html>",dialogLinkHtml:String()+'<body class="wym_dialog wym_dialog_link"  onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_LINK+'" /><legend>{Link}</legend><div class="row"><label>{URL}</label><input type="text" class="wym_href" value="" size="40" autofocus="autofocus" /></div><div class="row"><label>{Title}</label><input type="text" class="wym_title" value="" size="40" /></div><div class="row"><label>{Relationship}</label><input type="text" class="wym_rel" value="" size="40" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',
dialogImageHtml:String()+'<body class="wym_dialog wym_dialog_image" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_IMAGE+'" /><legend>{Image}</legend><div class="row"><label>{URL}</label><input type="text" class="wym_src" value="" size="40" autofocus="autofocus" /></div><div class="row"><label>{Alternative_Text}</label><input type="text" class="wym_alt" value="" size="40" /></div><div class="row"><label>{Title}</label><input type="text" class="wym_title" value="" size="40" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',
dialogTableHtml:String()+'<body class="wym_dialog wym_dialog_table" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_TABLE+'" /><legend>{Table}</legend><div class="row"><label>{Caption}</label><input type="text" class="wym_caption" value="" size="40" /></div><div class="row"><label>{Summary}</label><input type="text" class="wym_summary" value="" size="40" /></div><div class="row"><label>{Number_Of_Rows}</label><input type="text" class="wym_rows" value="3" size="3" /></div><div class="row"><label>{Number_Of_Cols}</label><input type="text" class="wym_cols" value="2" size="3" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',
dialogPasteHtml:String()+'<body class="wym_dialog wym_dialog_paste" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_PASTE+'" /><fieldset><legend>{Paste_From_Word}</legend><div class="row"><textarea class="wym_text" rows="10" cols="50" autofocus="autofocus"></textarea></div><div class="row"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',
dialogPreviewHtml:String()+'<body class="wym_dialog wym_dialog_preview" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"></body>',dialogStyles:[],stringDelimiterLeft:"{",stringDelimiterRight:"}",preInit:null,preBind:null,postInit:null,preInitDialog:null,postInitDialog:null},a);return this.each(function(){new WYMeditor.editor(jQuery(this),a)})};jQuery.extend({wymeditors:function(a){return WYMeditor.INSTANCES[a]}});
WYMeditor.computeWymPath=function(){var a=jQuery(jQuery.grep(jQuery("script"),function(a){return!a.src?null:a.src.match(/jquery\.wymeditor(\.pack|\.min|\.packed)?\.js(\?.*)?$/)||a.src.match(/\/core\.js(\?.*)?$/)}));if(0<a.length)return a.attr("src");WYMeditor.console.warn("Error determining wymPath. No base WYMeditor file located.");WYMeditor.console.warn("Assuming wymPath to be the current URL");WYMeditor.console.warn("Please pass a correct wymPath option");return""};
WYMeditor.computeBasePath=function(a){var b=a.lastIndexOf("/");return a.substr(0,b+1)};WYMeditor.computeJqueryPath=function(){return jQuery(jQuery.grep(jQuery("script"),function(a){return a.src&&a.src.match(/jquery(-(.*)){0,1}(\.pack|\.min|\.packed)?\.js(\?.*)?$/)})).attr("src")};
WYMeditor.INIT_DIALOG=function(a){var b=window.opener.WYMeditor.INSTANCES[a],a=window.document,c=b.selected(),d=jQuery(b._options.dialogTypeSelector).val(),e=b.uniqueStamp();d===WYMeditor.DIALOG_LINK&&(c&&(c.tagName&&c.tagName.toLowerCase!==WYMeditor.A)&&(c=jQuery(c).parentsOrSelf(WYMeditor.A)),!c&&b._selected_image&&(c=jQuery(b._selected_image).parentsOrSelf(WYMeditor.A)));jQuery.isFunction(b._options.preInitDialog)&&b._options.preInitDialog(b,window);d=eval(b._options.dialogStyles);b.addCssRules(a,
d);c&&(jQuery(b._options.hrefSelector).val(jQuery(c).attr(WYMeditor.HREF)),jQuery(b._options.srcSelector).val(jQuery(c).attr(WYMeditor.SRC)),jQuery(b._options.titleSelector).val(jQuery(c).attr(WYMeditor.TITLE)),jQuery(b._options.relSelector).val(jQuery(c).attr(WYMeditor.REL)),jQuery(b._options.altSelector).val(jQuery(c).attr(WYMeditor.ALT)));b._selected_image&&(jQuery(b._options.dialogImageSelector+" "+b._options.srcSelector).val(jQuery(b._selected_image).attr(WYMeditor.SRC)),jQuery(b._options.dialogImageSelector+
" "+b._options.titleSelector).val(jQuery(b._selected_image).attr(WYMeditor.TITLE)),jQuery(b._options.dialogImageSelector+" "+b._options.altSelector).val(jQuery(b._selected_image).attr(WYMeditor.ALT)));jQuery(b._options.dialogLinkSelector+" "+b._options.submitSelector).submit(function(){var a=jQuery(b._options.hrefSelector).val(),d;if(a.length>0){if(c[0]&&c[0].tagName.toLowerCase()===WYMeditor.A)d=c;else{b._exec(WYMeditor.CREATE_LINK,e);d=jQuery("a[href="+e+"]",b._doc.body)}d.attr(WYMeditor.HREF,a);
d.attr(WYMeditor.TITLE,jQuery(b._options.titleSelector).val());d.attr(WYMeditor.REL,jQuery(b._options.relSelector).val())}window.close()});jQuery(b._options.dialogImageSelector+" "+b._options.submitSelector).submit(function(){var a=jQuery(b._options.srcSelector).val(),c;if(a.length>0){b._exec(WYMeditor.INSERT_IMAGE,e);c=jQuery("img[src$="+e+"]",b._doc.body);c.attr(WYMeditor.SRC,a);c.attr(WYMeditor.TITLE,jQuery(b._options.titleSelector).val());c.attr(WYMeditor.ALT,jQuery(b._options.altSelector).val())}window.close()});
a=WYMeditor.MAKE_TABLE_ONCLICK(b);jQuery(b._options.dialogTableSelector+" "+b._options.submitSelector).submit(a);jQuery(b._options.dialogPasteSelector+" "+b._options.submitSelector).submit(function(){var a=jQuery(b._options.textSelector).val();b.paste(a);window.close()});jQuery(b._options.dialogPreviewSelector+" "+b._options.previewSelector).html(b.xhtml());jQuery(b._options.cancelSelector).mousedown(function(){window.close()});jQuery.isFunction(b._options.postInitDialog)&&b._options.postInitDialog(b,
window)};WYMeditor.MAKE_TABLE_ONCLICK=function(a){return function(){var b=jQuery(a._options.rowsSelector).val(),c=jQuery(a._options.colsSelector).val(),d=jQuery(a._options.captionSelector).val(),e=jQuery(a._options.summarySelector).val();a.insertTable(b,c,d,e);window.close()}};jQuery.fn.isPhantomNode=function(){return 3===this[0].nodeType?!/[^\t\n\r ]/.test(this[0].data):!1};
jQuery.fn.nextContentsUntil=function(a,b){var c=[],d=this.get(0),a=a?a:"",b=b?b:"";if(!d)return jQuery();for(d=d.nextSibling;d&&!jQuery(d).is(a);)c.push(d),d=d.nextSibling;c=jQuery(c);return b?c.filter(b):c};jQuery.fn.nextAllContents=function(){return jQuery(this).nextContentsUntil("","")};
jQuery.fn.prevContentsUntil=function(a,b){var c=[],d=this.get(0),a=a?a:"",b=b?b:"";if(!d)return jQuery();for(d=d.previousSibling;d&&!jQuery(d).is(a);)c.push(d),d=d.previousSibling;c=jQuery(c);return b?c.filter(b):c};jQuery.fn.prevAllContents=function(){return jQuery(this).prevContentsUntil("","")};WYMeditor.isPhantomNode=function(a){return 3===a.nodeType?!/[^\t\n\r ]/.test(a.data):!1};WYMeditor.isPhantomString=function(a){return!/[^\t\n\r ]/.test(a)};
jQuery.fn.parentsOrSelf=function(a){var b=this;3===b[0].nodeType&&(b=b.parents().slice(0,1));return 1===b.filter(a).size()?b:b.parents(a).slice(0,1)};WYMeditor.changeNodeType=function(a,b){var c,d,e=a.attributes;jQuery(a).wrapInner("<"+b+">");c=jQuery(a).children().get(0);for(d=0;d<e.length;d++)e[d].specified&&c.setAttribute(e[d].nodeName,e[d].nodeValue);jQuery(a).contents().unwrap();return c};
WYMeditor.Helper={replaceAll:function(a,b,c){return a.replace(RegExp(b,"g"),c)},insertAt:function(a,b,c){return a.substr(0,c)+b+a.substring(c)},trim:function(a){return a.replace(/^(\s*)|(\s*)$/gm,"")},contains:function(a,b){var c;for(c=0;c<a.length;c+=1)if(a[c]===b)return!0;return!1},indexOf:function(a,b){var c=-1,d;for(d=0;d<a.length;d+=1)if(a[d]===b){c=d;break}return c},findByName:function(a,b){var c,d;for(c=0;c<a.length;c+=1)if(d=a[c],d.name===b)return d;return null}};
window.rangy=function(){function a(a,b){var c=typeof a[b];return c==x||!!(c==l&&a[b])||"unknown"==c}function b(a,b){return!!(typeof a[b]==l&&a[b])}function c(a,b){return typeof a[b]!=v}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&m(a,p)&&y(a,t)}function g(a){window.alert("Rangy not supported in your browser. Reason: "+a);q.initialized=!0;q.supported=!1}function f(){if(!q.initialized){var c,d=!1,r=!1;a(document,"createRange")&&
(c=document.createRange(),m(c,o)&&y(c,u)&&(d=!0),c.detach());if((c=b(document,"body")?document.body:document.getElementsByTagName("body")[0])&&a(c,"createTextRange"))c=c.createTextRange(),e(c)&&(r=!0);!d&&!r&&g("Neither Range nor TextRange are implemented");q.initialized=!0;q.features={implementsDomRange:d,implementsTextRange:r};d=I.concat(D);r=0;for(c=d.length;r<c;++r)try{d[r](q)}catch(p){b(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
p)}}}function n(a){this.name=a;this.supported=this.initialized=!1}var l="object",x="function",v="undefined",u="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),o="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),
t="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),p="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),m=d(a),r=d(b),y=d(c),q={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:m,areHostObjects:r,areHostProperties:y,isTextRange:e},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};
q.fail=g;q.warn=function(a){a="Rangy warning: "+a;q.config.alertOnWarn?window.alert(a):typeof window.console!=v&&typeof window.console.log!=v&&window.console.log(a)};({}).hasOwnProperty?q.util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}:g("hasOwnProperty not supported");var D=[],I=[];q.init=f;q.addInitListener=function(a){q.initialized?a(q):D.push(a)};var E=[];q.addCreateMissingNativeApiListener=function(a){E.push(a)};q.createMissingNativeApi=function(a){a=a||window;f();
for(var b=0,c=E.length;b<c;++b)E[b](a)};n.prototype.fail=function(a){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+a);};n.prototype.warn=function(a){q.warn("Module "+this.name+": "+a)};n.prototype.createError=function(a){return Error("Error in Rangy "+this.name+" module: "+a)};q.createModule=function(a,b){var c=new n(a);q.modules[a]=c;I.push(function(a){b(a,c);c.initialized=!0;c.supported=!0})};q.requireModules=function(a){for(var b=0,c=a.length,d,e;b<
c;++b){e=a[b];d=q.modules[e];if(!d||!(d instanceof n))throw Error("Module '"+e+"' not found");if(!d.supported)throw Error("Module '"+e+"' not supported");}};var C=!1,r=function(){C||(C=!0,q.initialized||f())};if(typeof window==v)g("No window found");else if(typeof document==v)g("No document found");else return a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",r,!1),a(window,"addEventListener")?window.addEventListener("load",r,!1):a(window,"attachEvent")?window.attachEvent("onload",
r):g("Window does not have required addEventListener or attachEvent method"),q}();
rangy.createModule("DomUtil",function(a,b){function c(a){for(var b=0;a=a.previousSibling;)b++;return b}function d(a,b){var c=[],d;for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(m(c,d))return d;return null}function e(a,b,c){for(c=c?a:a.parentNode;c;){a=c.parentNode;if(a===b)return c;c=a}return null}function g(a){a=a.nodeType;return 3==a||4==a||8==a}function f(a,b){var c=b.nextSibling,d=b.parentNode;c?d.insertBefore(a,c):d.appendChild(a);return a}function n(a){if(9==a.nodeType)return a;
if(typeof a.ownerDocument!=o)return a.ownerDocument;if(typeof a.document!=o)return a.document;if(a.parentNode)return n(a.parentNode);throw Error("getDocument: no document found for node");}function l(a){return!a?"[No node]":g(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">["+a.childNodes.length+"]":a.nodeName}function x(a){this._next=this.root=a}function v(a,b){this.node=a;this.offset=b}function u(a){this.code=this[a];this.codeName=a;this.message="DOMException: "+this.codeName}
var o="undefined",t=a.util;t.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method");t.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var p=document.createElement("div");t.areHostMethods(p,["insertBefore","appendChild","cloneNode"])||b.fail("Incomplete Element implementation");t.isHostProperty(p,"innerHTML")||b.fail("Element is missing innerHTML property");p=document.createTextNode("test");
t.areHostMethods(p,["splitText","deleteData","insertData","appendData","cloneNode"])||b.fail("Incomplete Text Node implementation");var m=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};x.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b;if(this._current){b=a.firstChild;if(!b)for(b=null;a!==this.root&&!(b=a.nextSibling);)a=a.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=
null}};v.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+l(this.node)+":"+this.offset+")]"}};u.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};u.prototype.toString=function(){return this.message};a.dom={arrayContains:m,isHtmlNamespace:function(a){var b;return typeof a.namespaceURI==o||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==
b},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:c,getNodeLength:function(a){var b;return g(a)?a.length:(b=a.childNodes)?b.length:0},getCommonAncestor:d,isAncestorOf:function(a,b,c){for(b=c?b:b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1},getClosestAncestorIn:e,isCharacterDataNode:g,insertAfter:f,splitDataNode:function(a,b){var c=a.cloneNode(!1);c.deleteData(0,b);a.deleteData(b,a.length-b);f(c,a);return c},getDocument:n,getWindow:function(a){a=n(a);
if(typeof a.defaultView!=o)return a.defaultView;if(typeof a.parentWindow!=o)return a.parentWindow;throw Error("Cannot get a window object for node");},getIframeWindow:function(a){if(typeof a.contentWindow!=o)return a.contentWindow;if(typeof a.contentDocument!=o)return a.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(a){if(typeof a.contentDocument!=o)return a.contentDocument;if(typeof a.contentWindow!=o)return a.contentWindow.document;
throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(a){return t.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]},getRootContainer:function(a){for(var b;b=a.parentNode;)a=b;return a},comparePoints:function(a,b,p,m){var g;if(a==p)return b===m?0:b<m?-1:1;if(g=e(p,a,!0))return b<=c(g)?-1:1;if(g=e(a,p,!0))return c(g)<m?-1:1;b=d(a,p);a=a===b?b:e(a,b,!0);p=p===b?b:e(p,b,!0);if(a===p)throw Error("comparePoints got to case 4 and childA and childB are the same!");
for(b=b.firstChild;b;){if(b===a)return-1;if(b===p)return 1;b=b.nextSibling}throw Error("Should not be here!");},inspectNode:l,fragmentFromNodeChildren:function(a){for(var b=n(a).createDocumentFragment(),c;c=a.firstChild;)b.appendChild(c);return b},createIterator:function(a){return new x(a)},DomPosition:v};a.DOMException=u});
rangy.createModule("DomRange",function(a){function b(a,b){return 3!=a.nodeType&&(h.isAncestorOf(a,b.startContainer,!0)||h.isAncestorOf(a,b.endContainer,!0))}function c(a){return h.getDocument(a.startContainer)}function d(a,b,c){if(b=a._listeners[b])for(var d=0,k=b.length;d<k;++d)b[d].call(a,{target:a,args:c})}function e(a){return new J(a.parentNode,h.getNodeIndex(a))}function g(a){return new J(a.parentNode,h.getNodeIndex(a)+1)}function f(a,b,c){var d=11==a.nodeType?a.firstChild:a;h.isCharacterDataNode(b)?
c==b.length?h.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:h.splitDataNode(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]);return d}function n(a){for(var b,d,k=c(a.range).createDocumentFragment();d=a.next();){b=a.isPartiallySelectedSubtree();d=d.cloneNode(!b);b&&(b=a.getSubtreeIterator(),d.appendChild(n(b)),b.detach(!0));if(10==d.nodeType)throw new B("HIERARCHY_REQUEST_ERR");k.appendChild(d)}return k}function l(a,b,c){for(var d,k,c=c||{stop:!1};d=a.next();)if(a.isPartiallySelectedSubtree())if(!1===
b(d)){c.stop=!0;break}else{if(d=a.getSubtreeIterator(),l(d,b,c),d.detach(!0),c.stop)break}else for(d=h.createIterator(d);k=d.next();)if(!1===b(k)){c.stop=!0;return}}function x(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),x(b),b.detach(!0)):a.remove()}function v(a){for(var b,d=c(a.range).createDocumentFragment(),k;b=a.next();){a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),k=a.getSubtreeIterator(),b.appendChild(v(k)),k.detach(!0)):a.remove();if(10==b.nodeType)throw new B("HIERARCHY_REQUEST_ERR");
d.appendChild(b)}return d}function u(a,b,c){var d=!(!b||!b.length),k,e=!!c;d&&(k=RegExp("^("+b.join("|")+")$"));var p=[];l(new t(a,!1),function(a){(!d||k.test(a.nodeType))&&(!e||c(a))&&p.push(a)});return p}function o(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+h.inspectNode(a.startContainer)+":"+a.startOffset+", "+h.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function t(a,b){this.range=a;this.clonePartiallySelectedTextNodes=b;if(!a.collapsed){this.sc=a.startContainer;
this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&h.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===c&&!h.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:h.getClosestAncestorIn(this.sc,c,!0),this._last=this.ec===c&&!h.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:h.getClosestAncestorIn(this.ec,c,!0))}}function p(a){this.code=
this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function m(a,b,c){this.nodes=u(a,b,c);this._next=this.nodes[0];this._position=0}function r(a){return function(b,c){for(var d,k=c?b:b.parentNode;k;){d=k.nodeType;if(h.arrayContains(a,d))return k;k=k.parentNode}return null}}function y(a,b){if(O(a,b))throw new p("INVALID_NODE_TYPE_ERR");}function q(a){if(!a.startContainer)throw new B("INVALID_STATE_ERR");}function D(a,b){if(!h.arrayContains(b,a.nodeType))throw new p("INVALID_NODE_TYPE_ERR");
}function I(a,b){if(0>b||b>(h.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new B("INDEX_SIZE_ERR");}function E(a,b){if(K(a,!0)!==K(b,!0))throw new B("WRONG_DOCUMENT_ERR");}function C(a){if(W(a,!0))throw new B("NO_MODIFICATION_ALLOWED_ERR");}function A(a,b){if(!a)throw new B(b);}function w(a){q(a);if(!h.arrayContains(P,a.startContainer.nodeType)&&!K(a.startContainer,!0)||!h.arrayContains(P,a.endContainer.nodeType)&&!K(a.endContainer,!0)||!(a.startOffset<=(h.isCharacterDataNode(a.startContainer)?
a.startContainer.length:a.startContainer.childNodes.length))||!(a.endOffset<=(h.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function H(){}function T(a){a.START_TO_START=X;a.START_TO_END=$;a.END_TO_END=ea;a.END_TO_START=aa;a.NODE_BEFORE=ba;a.NODE_AFTER=ca;a.NODE_BEFORE_AND_AFTER=da;a.NODE_INSIDE=Y}function s(a){T(a);T(a.prototype)}function L(a,b){return function(){w(this);
var c=this.startContainer,d=this.startOffset,k=this.commonAncestorContainer,e=new t(this,!0);c!==k&&(c=h.getClosestAncestorIn(c,k,!0),d=g(c),c=d.node,d=d.offset);l(e,C);e.reset();k=a(e);e.detach();b(this,c,d,c,d);return k}}function Q(c,d,k){function p(a,b){return function(c){q(this);D(c,F);D(M(c),P);c=(a?e:g)(c);(b?N:m)(this,c.node,c.offset)}}function N(a,b,c){var k=a.endContainer,e=a.endOffset;if(b!==a.startContainer||c!==a.startOffset){if(M(b)!=M(k)||1==h.comparePoints(b,c,k,e))k=b,e=c;d(a,b,c,
k,e)}}function m(a,b,c){var k=a.startContainer,e=a.startOffset;if(b!==a.endContainer||c!==a.endOffset){if(M(b)!=M(k)||-1==h.comparePoints(b,c,k,e))k=b,e=c;d(a,k,e,b,c)}}c.prototype=new H;a.util.extend(c.prototype,{setStart:function(a,b){q(this);y(a,!0);I(a,b);N(this,a,b)},setEnd:function(a,b){q(this);y(a,!0);I(a,b);m(this,a,b)},setStartBefore:p(!0,!0),setStartAfter:p(!1,!0),setEndBefore:p(!0,!1),setEndAfter:p(!1,!1),collapse:function(a){w(this);a?d(this,this.startContainer,this.startOffset,this.startContainer,
this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){q(this);y(a,!0);d(this,a,0,a,h.getNodeLength(a))},selectNode:function(a){q(this);y(a,!1);D(a,F);var b=e(a),a=g(a);d(this,b.node,b.offset,a.node,a.offset)},extractContents:L(v,d),deleteContents:L(x,d),canSurroundContents:function(){w(this);C(this.startContainer);C(this.endContainer);var a=new t(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);a.detach();return!c},
detach:function(){k(this)},splitBoundaries:function(){w(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,k=this.endOffset,e=a===c;h.isCharacterDataNode(c)&&(0<k&&k<c.length)&&h.splitDataNode(c,k);h.isCharacterDataNode(a)&&(0<b&&b<a.length)&&(a=h.splitDataNode(a,b),e?(k-=b,c=a):c==a.parentNode&&k>=h.getNodeIndex(a)&&k++,b=0);d(this,a,b,c,k)},normalizeBoundaries:function(){w(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,k=this.endOffset,e=function(a){var b=
a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,k=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},V=function(d){var e=d.previousSibling;if(e&&e.nodeType==d.nodeType){a=d;var V=d.length;b=e.length;d.insertData(0,e.data);e.parentNode.removeChild(e);a==c?(k+=b,c=a):c==d.parentNode&&(e=h.getNodeIndex(d),k==e?(c=d,k=V):k>e&&k--)}},p=!0;h.isCharacterDataNode(c)?c.length==k&&e(c):(0<k&&(p=c.childNodes[k-1])&&h.isCharacterDataNode(p)&&e(p),p=!this.collapsed);p?h.isCharacterDataNode(a)?0==b&&V(a):
b<a.childNodes.length&&(e=a.childNodes[b])&&h.isCharacterDataNode(e)&&V(e):(a=c,b=k);d(this,a,b,c,k)},collapseToPoint:function(a,b){q(this);y(a,!0);I(a,b);(a!==this.startContainer||b!==this.startOffset||a!==this.endContainer||b!==this.endOffset)&&d(this,a,b,a,b)}});s(c)}function U(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:h.getCommonAncestor(a.startContainer,a.endContainer)}function R(a,b,c,k,e){var p=a.startContainer!==
b||a.startOffset!==c,N=a.endContainer!==k||a.endOffset!==e;a.startContainer=b;a.startOffset=c;a.endContainer=k;a.endOffset=e;U(a);d(a,"boundarychange",{startMoved:p,endMoved:N})}function z(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};U(this)}a.requireModules(["DomUtil"]);var h=a.dom,J=h.DomPosition,B=a.DOMException;t.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=
null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,h.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,b,c;h.isCharacterDataNode(a)&&(a===this.sc||a===this.ec)?(b=a===this.sc?this.so:0,c=a===
this.ec?this.eo:a.length,b!=c&&a.deleteData(b,c-b)):a.parentNode&&a.parentNode.removeChild(a)},isPartiallySelectedSubtree:function(){return b(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new z(c(this.range));var b=this._current,d=b,k=0,e=b,p=h.getNodeLength(b);h.isAncestorOf(b,this.sc,!0)&&(d=this.sc,k=this.so);h.isAncestorOf(b,this.ec,!0)&&(e=this.ec,p=this.eo);R(a,d,k,e,p)}return new t(a,this.clonePartiallySelectedTextNodes)},
detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};p.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};p.prototype.toString=function(){return this.message};m.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var F=[1,3,4,5,
7,8,10],P=[2,9,11],G=[1,3,4,5,7,8,10,11],S=[1,3,4,5,7,8],M=h.getRootContainer,K=r([9,11]),W=r([5,6,10,12]),O=r([6,10,12]),k=document.createElement("style"),N=!1;try{k.innerHTML="<b>x</b>",N=3==k.firstChild.nodeType}catch(fa){}a.features.htmlParsingConforms=N;var Z="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),X=0,$=1,ea=2,aa=3,ba=0,ca=1,da=2,Y=3;H.prototype={attachListener:function(a,b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,
b){w(this);E(this.startContainer,b.startContainer);var c=a==aa||a==X?"start":"end",d=a==$||a==X?"start":"end";return h.comparePoints(this[c+"Container"],this[c+"Offset"],b[d+"Container"],b[d+"Offset"])},insertNode:function(a){w(this);D(a,G);C(this.startContainer);if(h.isAncestorOf(a,this.startContainer,!0))throw new B("HIERARCHY_REQUEST_ERR");a=f(a,this.startContainer,this.startOffset);this.setStartBefore(a)},cloneContents:function(){w(this);var a,b;if(this.collapsed)return c(this).createDocumentFragment();
if(this.startContainer===this.endContainer&&h.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=c(this).createDocumentFragment(),b.appendChild(a),b;b=new t(this,!0);a=n(b);b.detach();return a},canSurroundContents:function(){w(this);C(this.startContainer);C(this.endContainer);var a=new t(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);a.detach();return!c},surroundContents:function(a){D(a,S);if(!this.canSurroundContents())throw new p("BAD_BOUNDARYPOINTS_ERR");
var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);f(a,this.startContainer,this.startOffset);a.appendChild(b);this.selectNode(a)},cloneRange:function(){w(this);for(var a=new z(c(this)),b=Z.length,d;b--;)d=Z[b],a[d]=this[d];return a},toString:function(){w(this);var a=this.startContainer;if(a===this.endContainer&&h.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],a=new t(this,!0);l(a,function(a){(3==
a.nodeType||4==a.nodeType)&&b.push(a.data)});a.detach();return b.join("")},compareNode:function(a){w(this);var b=a.parentNode,c=h.getNodeIndex(a);if(!b)throw new B("NOT_FOUND_ERR");a=this.comparePoint(b,c);b=this.comparePoint(b,c+1);return 0>a?0<b?da:ba:0<b?ca:Y},comparePoint:function(a,b){w(this);A(a,"HIERARCHY_REQUEST_ERR");E(a,this.startContainer);return 0>h.comparePoints(a,b,this.startContainer,this.startOffset)?-1:0<h.comparePoints(a,b,this.endContainer,this.endOffset)?1:0},createContextualFragment:N?
function(a){var b=this.startContainer,c=h.getDocument(b);if(!b)throw new B("INVALID_STATE_ERR");var d=null;1==b.nodeType?d=b:h.isCharacterDataNode(b)&&(d=h.parentElement(b));d=null===d||"HTML"==d.nodeName&&h.isHtmlNamespace(h.getDocument(d).documentElement)&&h.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1);d.innerHTML=a;return h.fragmentFromNodeChildren(d)}:function(a){q(this);var b=c(this).createElement("body");b.innerHTML=a;return h.fragmentFromNodeChildren(b)},toHtml:function(){w(this);
var a=c(this).createElement("div");a.appendChild(this.cloneContents());return a.innerHTML},intersectsNode:function(a,b){w(this);A(a,"NOT_FOUND_ERR");if(h.getDocument(a)!==c(this))return!1;var d=a.parentNode,k=h.getNodeIndex(a);A(d,"NOT_FOUND_ERR");var e=h.comparePoints(d,k,this.endContainer,this.endOffset),d=h.comparePoints(d,k+1,this.startContainer,this.startOffset);return b?0>=e&&0<=d:0>e&&0<d},isPointInRange:function(a,b){w(this);A(a,"HIERARCHY_REQUEST_ERR");E(a,this.startContainer);return 0<=
h.comparePoints(a,b,this.startContainer,this.startOffset)&&0>=h.comparePoints(a,b,this.endContainer,this.endOffset)},intersectsRange:function(a,b){w(this);if(c(a)!=c(this))throw new B("WRONG_DOCUMENT_ERR");var d=h.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),k=h.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return b?0>=d&&0<=k:0>d&&0<k},intersection:function(a){if(this.intersectsRange(a)){var b=h.comparePoints(this.startContainer,
this.startOffset,a.startContainer,a.startOffset),c=h.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();-1==b&&d.setStart(a.startContainer,a.startOffset);1==c&&d.setEnd(a.endContainer,a.endOffset);return d}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();-1==h.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset);1==h.comparePoints(a.endContainer,
a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset);return b}throw new p("Ranges do not intersect");},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==Y},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,h.getNodeLength(a))},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);return 0<c.length?
(b.setStart(c[0],0),a=c.pop(),b.setEnd(a,a.length),a=this.containsRange(b),b.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(a,b){w(this);return new m(this,a,b)},getNodes:function(a,b){w(this);return u(this,a,b)},getDocument:function(){return c(this)},collapseBefore:function(a){q(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){q(this);this.setStartAfter(a);this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return z.rangesEqual(this,
a)},inspect:function(){return o(this)}};Q(z,R,function(a){q(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;d(a,"detach",null);a._listeners=null});a.rangePrototype=H.prototype;z.rangeProperties=Z;z.RangeIterator=t;z.copyComparisonConstants=s;z.createPrototypeRange=Q;z.inspect=o;z.getRangeDocument=c;z.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===
b.endOffset};a.DomRange=z;a.RangeException=p});
rangy.createModule("WrappedRange",function(a){function b(a,b,c,d){var f=a.duplicate();f.collapse(c);var l=f.parentElement();e.isAncestorOf(b,l,!0)||(l=b);if(!l.canHaveHTML)return new g(l.parentNode,e.getNodeIndex(l));var b=e.getDocument(l).createElement("span"),u,o=c?"StartToStart":"StartToEnd";do l.insertBefore(b,b.previousSibling),f.moveToElementText(b);while(0<(u=f.compareEndPoints(o,a))&&b.previousSibling);o=b.nextSibling;if(-1==u&&o&&e.isCharacterDataNode(o)){f.setEndPoint(c?"EndToStart":"EndToEnd",
a);if(/[\r\n]/.test(o.data)){l=f.duplicate();c=l.text.replace(/\r\n/g,"\r").length;for(c=l.moveStart("character",c);-1==l.compareEndPoints("StartToEnd",l);)c++,l.moveStart("character",1)}else c=f.text.length;l=new g(o,c)}else o=(d||!c)&&b.previousSibling,l=(c=(d||c)&&b.nextSibling)&&e.isCharacterDataNode(c)?new g(c,0):o&&e.isCharacterDataNode(o)?new g(o,o.length):new g(l,e.getNodeIndex(b));b.parentNode.removeChild(b);return l}function c(a,b){var c,d,g=a.offset,f=e.getDocument(a.node),l=f.body.createTextRange(),
o=e.isCharacterDataNode(a.node);o?(c=a.node,d=c.parentNode):(c=a.node.childNodes,c=g<c.length?c[g]:null,d=a.node);f=f.createElement("span");f.innerHTML="&#feff;";c?d.insertBefore(f,c):d.appendChild(f);l.moveToElementText(f);l.collapse(!b);d.removeChild(f);if(o)l[b?"moveStart":"moveEnd"]("character",g);return l}a.requireModules(["DomUtil","DomRange"]);var d,e=a.dom,g=e.DomPosition,f=a.DomRange;if(a.features.implementsDomRange&&(!a.features.implementsTextRange||!a.config.preferTextRange)){var n=function(a){for(var b=
x.length,c;b--;)c=x[b],a[c]=a.nativeRange[c]},l,x=f.rangeProperties,v;d=function(a){if(!a)throw Error("Range must be specified");this.nativeRange=a;n(this)};f.createPrototypeRange(d,function(a,b,c,d,e){var f=a.endContainer!==d||a.endOffset!=e;if(a.startContainer!==b||a.startOffset!=c||f)a.setEnd(d,e),a.setStart(b,c)},function(a){a.nativeRange.detach();a.detached=!0;for(var b=x.length,c;b--;)c=x[b],a[c]=null});l=d.prototype;l.selectNode=function(a){this.nativeRange.selectNode(a);n(this)};l.deleteContents=
function(){this.nativeRange.deleteContents();n(this)};l.extractContents=function(){var a=this.nativeRange.extractContents();n(this);return a};l.cloneContents=function(){return this.nativeRange.cloneContents()};l.surroundContents=function(a){this.nativeRange.surroundContents(a);n(this)};l.collapse=function(a){this.nativeRange.collapse(a);n(this)};l.cloneRange=function(){return new d(this.nativeRange.cloneRange())};l.refresh=function(){n(this)};l.toString=function(){return this.nativeRange.toString()};
var u=document.createTextNode("test");e.getBody(document).appendChild(u);var o=document.createRange();o.setStart(u,0);o.setEnd(u,0);try{o.setStart(u,1),l.setStart=function(a,b){this.nativeRange.setStart(a,b);n(this)},l.setEnd=function(a,b){this.nativeRange.setEnd(a,b);n(this)},v=function(a){return function(b){this.nativeRange[a](b);n(this)}}}catch(t){l.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}n(this)},l.setEnd=function(a,
b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}n(this)},v=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(d){this.nativeRange[b](c),this.nativeRange[a](c)}n(this)}}}l.setStartBefore=v("setStartBefore","setEndBefore");l.setStartAfter=v("setStartAfter","setEndAfter");l.setEndBefore=v("setEndBefore","setStartBefore");l.setEndAfter=v("setEndAfter","setStartAfter");o.selectNodeContents(u);l.selectNodeContents=o.startContainer==
u&&o.endContainer==u&&0==o.startOffset&&o.endOffset==u.length?function(a){this.nativeRange.selectNodeContents(a);n(this)}:function(a){this.setStart(a,0);this.setEnd(a,f.getEndOffset(a))};o.selectNodeContents(u);o.setEnd(u,3);v=document.createRange();v.selectNodeContents(u);v.setEnd(u,4);v.setStart(u,2);l.compareBoundaryPoints=-1==o.compareBoundaryPoints(o.START_TO_END,v)&1==o.compareBoundaryPoints(o.END_TO_START,v)?function(a,b){b=b.nativeRange||b;a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&
(a=b.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};a.util.isHostMethod(o,"createContextualFragment")&&(l.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});e.getBody(document).removeChild(u);o.detach();v.detach();a.createNativeRange=function(a){a=a||document;return a.createRange()}}else a.features.implementsTextRange&&(d=function(a){this.textRange=a;this.refresh()},
d.prototype=new f(document),d.prototype.refresh=function(){var a,c,d=this.textRange;a=d.parentElement();var f=d.duplicate();f.collapse(!0);c=f.parentElement();f=d.duplicate();f.collapse(!1);d=f.parentElement();c=c==d?c:e.getCommonAncestor(c,d);c=c==a?c:e.getCommonAncestor(a,c);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?c=a=b(this.textRange,c,!0,!0):(a=b(this.textRange,c,!0,!1),c=b(this.textRange,c,!1,!1));this.setStart(a.node,a.offset);this.setEnd(c.node,c.offset)},f.copyComparisonConstants(d),
l=function(){return this}(),"undefined"==typeof l.Range&&(l.Range=d),a.createNativeRange=function(a){a=a||document;return a.body.createTextRange()});a.features.implementsTextRange&&(d.rangeToTextRange=function(a){if(a.collapsed)return c(new g(a.startContainer,a.startOffset),!0);var b=c(new g(a.startContainer,a.startOffset),!0),d=c(new g(a.endContainer,a.endOffset),!1),a=e.getDocument(a.startContainer).body.createTextRange();a.setEndPoint("StartToStart",b);a.setEndPoint("EndToEnd",d);return a});d.prototype.getName=
function(){return"WrappedRange"};a.WrappedRange=d;a.createRange=function(b){b=b||document;return new d(a.createNativeRange(b))};a.createRangyRange=function(a){a=a||document;return new f(a)};a.createIframeRange=function(b){return a.createRange(e.getIframeDocument(b))};a.createIframeRangyRange=function(b){return a.createRangyRange(e.getIframeDocument(b))};a.addCreateMissingNativeApiListener(function(b){b=b.document;if(typeof b.createRange=="undefined")b.createRange=function(){return a.createRange(this)};
b=b=null})});
rangy.createModule("WrappedSelection",function(a,b){function c(a){return(a||window).getSelection()}function d(a){return(a||window).document.selection}function e(a,b,c){var d=c?"end":"start",c=c?"start":"end";a.anchorNode=b[d+"Container"];a.anchorOffset=b[d+"Offset"];a.focusNode=b[c+"Container"];a.focusOffset=b[c+"Offset"]}function g(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function f(b){var c;b instanceof y?(c=b._selectionNativeRange,
c||(c=a.createNativeRange(m.getDocument(b.startContainer)),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=c,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof q?c=b.nativeRange:a.features.implementsDomRange&&b instanceof m.getWindow(b.startContainer).Range&&(c=b);return c}function n(a){var b=a.getNodes(),c;a:if(!b.length||1!=b[0].nodeType)c=!1;else{c=1;for(var d=b.length;c<d;++c)if(!m.isAncestorOf(b[0],b[c])){c=
!1;break a}c=!0}if(!c)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function l(a,b){var c=new q(b);a._ranges=[c];e(a,c,!1);a.rangeCount=1;a.isCollapsed=c.collapsed}function x(b){b._ranges.length=0;if("None"==b.docSelection.type)g(b);else{var c=b.docSelection.createRange();if(c&&"undefined"!=typeof c.text)l(b,c);else{b.rangeCount=c.length;for(var d,f=m.getDocument(c.item(0)),h=0;h<b.rangeCount;++h)d=a.createRange(f),d.selectNode(c.item(h)),
b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed;e(b,b._ranges[b.rangeCount-1],!1)}}}function v(a,b){for(var c=a.docSelection.createRange(),d=n(b),e=m.getDocument(c.item(0)),e=m.getBody(e).createControlRange(),f=0,g=c.length;f<g;++f)e.add(c.item(f));try{e.add(d)}catch(l){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}e.select();x(a)}function u(a,b,c){this.nativeSelection=a;this.docSelection=b;this._ranges=
[];this.win=c;this.refresh()}function o(a,b){for(var c=m.getDocument(b[0].startContainer),c=m.getBody(c).createControlRange(),d=0,e;d<rangeCount;++d){e=n(b[d]);try{c.add(e)}catch(f){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}c.select();x(a)}function t(a,b){if(a.anchorNode&&m.getDocument(a.anchorNode)!==m.getDocument(b))throw new D("WRONG_DOCUMENT_ERR");}function p(a){var b=[],c=new I(a.anchorNode,a.anchorOffset),
d=new I(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;f<g;++f)b[f]=y.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]);a.config.checkSelectionRanges=!0;var m=a.dom,r=a.util,y=a.DomRange,q=a.WrappedRange,D=a.DOMException,I=m.DomPosition,E,C,A=a.util.isHostMethod(window,"getSelection"),
w=a.util.isHostObject(document,"selection"),H=w&&(!A||a.config.preferTextRange);H?(E=d,a.isSelectionValid=function(a){var a=(a||window).document,b=a.selection;return"None"!=b.type||m.getDocument(b.createRange().parentElement())==a}):A?(E=c,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected.");a.getNativeSelection=E;var A=E(),T=a.createNativeRange(document),s=m.getBody(document),L=r.areHostObjects(A,r.areHostProperties(A,["anchorOffset","focusOffset"]));
a.features.selectionHasAnchorAndFocus=L;var Q=r.isHostMethod(A,"extend");a.features.selectionHasExtend=Q;var U="number"==typeof A.rangeCount;a.features.selectionHasRangeCount=U;var R=!1,z=!0;if(r.areHostMethods(A,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof A.rangeCount&&a.features.implementsDomRange){var h=document.createElement("iframe");s.appendChild(h);z=m.getIframeDocument(h);z.open();z.write("<html><head></head><body>12</body></html>");z.close();var J=m.getIframeWindow(h).getSelection(),
B=z.documentElement.lastChild.firstChild,F=z.createRange();F.setStart(B,1);F.collapse(!0);J.addRange(F);z=1==J.rangeCount;J.removeAllRanges();var P=F.cloneRange();F.setStart(B,0);P.setEnd(B,2);J.addRange(F);J.addRange(P);R=2==J.rangeCount;F.detach();P.detach();s.removeChild(h)}a.features.selectionSupportsMultipleRanges=R;a.features.collapsedNonEditableSelectionsSupported=z;var G=!1;s&&r.isHostMethod(s,"createControlRange")&&(s=s.createControlRange(),r.areHostProperties(s,["item","add"])&&(G=!0));
a.features.implementsControlRange=G;C=L?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:false};var S;r.isHostMethod(A,"getRangeAt")?S=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:L&&(S=function(b){var c=m.getDocument(b.anchorNode),c=a.createRange(c);c.setStart(b.anchorNode,b.anchorOffset);c.setEnd(b.focusNode,b.focusOffset);if(c.collapsed!==this.isCollapsed){c.setStart(b.focusNode,
b.focusOffset);c.setEnd(b.anchorNode,b.anchorOffset)}return c});a.getSelection=function(a){var a=a||window,b=a._rangySelection,c=E(a),e=w?d(a):null;if(b){b.nativeSelection=c;b.docSelection=e;b.refresh(a)}else{b=new u(c,e,a);a._rangySelection=b}return b};a.getIframeSelection=function(b){return a.getSelection(m.getIframeWindow(b))};s=u.prototype;if(!H&&L&&r.areHostMethods(A,["removeAllRanges","addRange"])){s.removeAllRanges=function(){this.nativeSelection.removeAllRanges();g(this)};var M=function(b,
c){var d=y.getRangeDocument(c),d=a.createRange(d);d.collapseToPoint(c.endContainer,c.endOffset);b.nativeSelection.addRange(f(d));b.nativeSelection.extend(c.startContainer,c.startOffset);b.refresh()};s.addRange=U?function(b,c){if(G&&w&&this.docSelection.type=="Control")v(this,b);else if(c&&Q)M(this,b);else{var d;if(R)d=this.rangeCount;else{this.removeAllRanges();d=0}this.nativeSelection.addRange(f(b));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==d+1){if(a.config.checkSelectionRanges)(d=
S(this.nativeSelection,this.rangeCount-1))&&!y.rangesEqual(d,b)&&(b=new q(d));this._ranges[this.rangeCount-1]=b;e(this,b,O(this.nativeSelection));this.isCollapsed=C(this)}else this.refresh()}}:function(a,b){if(b&&Q)M(this,a);else{this.nativeSelection.addRange(f(a));this.refresh()}};s.setRanges=function(a){if(G&&a.length>1)o(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else if(r.isHostMethod(A,"empty")&&r.isHostMethod(T,"select")&&G&&H)s.removeAllRanges=
function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var a;if(this.anchorNode)a=m.getDocument(this.anchorNode);else if(this.docSelection.type=="Control"){var b=this.docSelection.createRange();b.length&&(a=m.getDocument(b.item(0)).body.createTextRange())}if(a){a.body.createTextRange().select();this.docSelection.empty()}}}catch(c){}g(this)},s.addRange=function(a){if(this.docSelection.type=="Control")v(this,a);else{q.rangeToTextRange(a).select();this._ranges[0]=a;this.rangeCount=
1;this.isCollapsed=this._ranges[0].collapsed;e(this,a,false)}},s.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?o(this,a):b&&this.addRange(a[0])};else return b.fail("No means of selecting a Range or TextRange was found"),!1;s.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new D("INDEX_SIZE_ERR");return this._ranges[a]};var K;if(H)K=function(b){var c;if(a.isSelectionValid(b.win))c=b.docSelection.createRange();else{c=m.getBody(b.win.document).createTextRange();c.collapse(true)}b.docSelection.type==
"Control"?x(b):c&&typeof c.text!="undefined"?l(b,c):g(b)};else if(r.isHostMethod(A,"getRangeAt")&&"number"==typeof A.rangeCount)K=function(b){if(G&&w&&b.docSelection.type=="Control")x(b);else{b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount;if(b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));e(b,b._ranges[b.rangeCount-1],O(b.nativeSelection));b.isCollapsed=C(b)}else g(b)}};else if(L&&"boolean"==typeof A.isCollapsed&&"boolean"==
typeof T.collapsed&&a.features.implementsDomRange)K=function(a){var b;b=a.nativeSelection;if(b.anchorNode){b=S(b,0);a._ranges=[b];a.rangeCount=1;b=a.nativeSelection;a.anchorNode=b.anchorNode;a.anchorOffset=b.anchorOffset;a.focusNode=b.focusNode;a.focusOffset=b.focusOffset;a.isCollapsed=C(a)}else g(a)};else return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;s.refresh=function(a){var b=a?this._ranges.slice(0):null;K(this);if(a){a=b.length;if(a!=this._ranges.length)return false;
for(;a--;)if(!y.rangesEqual(b[a],this._ranges[a]))return false;return true}};var W=function(a,b){var c=a.getAllRanges(),d=false;a.removeAllRanges();for(var e=0,f=c.length;e<f;++e)d||b!==c[e]?a.addRange(c[e]):d=true;a.rangeCount||g(a)};s.removeRange=G?function(a){if(this.docSelection.type=="Control"){for(var b=this.docSelection.createRange(),a=n(a),c=m.getDocument(b.item(0)),c=m.getBody(c).createControlRange(),d,e=false,f=0,g=b.length;f<g;++f){d=b.item(f);d!==a||e?c.add(b.item(f)):e=true}c.select();
x(this)}else W(this,a)}:function(a){W(this,a)};var O;!H&&L&&a.features.implementsDomRange?(O=function(a){var b=false;a.anchorNode&&(b=m.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)==1);return b},s.isBackwards=function(){return O(this)}):O=s.isBackwards=function(){return false};s.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};s.collapse=function(b,c){t(this,b);var d=a.createRange(m.getDocument(b));d.collapseToPoint(b,
c);this.removeAllRanges();this.addRange(d);this.isCollapsed=true};s.collapseToStart=function(){if(this.rangeCount){var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new D("INVALID_STATE_ERR");};s.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new D("INVALID_STATE_ERR");};s.selectAllChildren=function(b){t(this,b);var c=a.createRange(m.getDocument(b));c.selectNodeContents(b);this.removeAllRanges();
this.addRange(c)};s.deleteFromDocument=function(){if(G&&w&&this.docSelection.type=="Control"){for(var a=this.docSelection.createRange(),b;a.length;){b=a.item(0);a.remove(b);b.parentNode.removeChild(b)}this.refresh()}else if(this.rangeCount){a=this.getAllRanges();this.removeAllRanges();b=0;for(var c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};s.getAllRanges=function(){return this._ranges.slice(0)};s.setSingleRange=function(a){this.setRanges([a])};s.containsNode=function(a,b){for(var c=
0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return true;return false};s.toHtml=function(){var a="";if(this.rangeCount){for(var a=y.getRangeDocument(this._ranges[0]).createElement("div"),b=0,c=this._ranges.length;b<c;++b)a.appendChild(this._ranges[b].cloneContents());a=a.innerHTML}return a};s.getName=function(){return"WrappedSelection"};s.inspect=function(){return p(this)};s.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};u.inspect=
p;a.Selection=u;a.selectionPrototype=s;a.addCreateMissingNativeApiListener(function(b){if(typeof b.getSelection=="undefined")b.getSelection=function(){return a.getSelection(this)};b=null})});
rangy.createModule("SaveRestore",function(a,b){function c(a,b){var c="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),d,e=f.getDocument(a.startContainer),g=a.cloneRange();g.collapse(b);d=e.createElement("span");d.id=c;d.style.lineHeight="0";d.style.display="none";d.className="rangySelectionBoundary";d.appendChild(e.createTextNode(n));g.insertNode(d);g.detach();return d}function d(a,c,d,e){(a=(a||document).getElementById(d))?(c[e?"setStartBefore":"setEndBefore"](a),a.parentNode.removeChild(a)):
b.warn("Marker element has been removed. Cannot restore selection.")}function e(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function g(a,b){var c=(a||document).getElementById(b);c&&c.parentNode.removeChild(c)}a.requireModules(["DomUtil","DomRange","WrappedRange"]);var f=a.dom,n="\ufeff";a.saveSelection=function(d){var d=d||window,f=d.document;if(a.isSelectionValid(d)){var g=a.getSelection(d),n=g.getAllRanges(),o=[],t,p;n.sort(e);for(var m=0,r=n.length;m<r;++m)t=n[m],t.collapsed?(p=c(t,
!1),o.push({markerId:p.id,collapsed:!0})):(p=c(t,!1),t=c(t,!0),o[m]={startMarkerId:t.id,endMarkerId:p.id,collapsed:!1,backwards:1==n.length&&g.isBackwards()});for(m=r-1;0<=m;--m)t=n[m],t.collapsed?t.collapseBefore((f||document).getElementById(o[m].markerId)):(t.setEndBefore((f||document).getElementById(o[m].endMarkerId)),t.setStartAfter((f||document).getElementById(o[m].startMarkerId)));g.setRanges(n);return{win:d,doc:f,rangeInfos:o,restored:!1}}b.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.")};
a.restoreSelection=function(c,e){if(!c.restored){for(var f=c.rangeInfos,g=a.getSelection(c.win),o=[],n=f.length,p=n-1,m,r;0<=p;--p){m=f[p];r=a.createRange(c.doc);if(m.collapsed)if(m=(c.doc||document).getElementById(m.markerId)){m.style.display="inline";var y=m.previousSibling;y&&3==y.nodeType?(m.parentNode.removeChild(m),r.collapseToPoint(y,y.length)):(r.collapseBefore(m),m.parentNode.removeChild(m))}else b.warn("Marker element has been removed. Cannot restore selection.");else d(c.doc,r,m.startMarkerId,
!0),d(c.doc,r,m.endMarkerId,!1);1==n&&r.normalizeBoundaries();o[p]=r}1==n&&e&&a.features.selectionHasExtend&&f[0].backwards?(g.removeAllRanges(),g.addRange(o[0],!0)):g.setRanges(o);c.restored=!0}};a.removeMarkerElement=g;a.removeMarkers=function(a){for(var b=a.rangeInfos,c=0,d=b.length,e;c<d;++c)e=b[c],e.collapsed?g(a.doc,e.markerId):(g(a.doc,e.startMarkerId),g(a.doc,e.endMarkerId))}});
WYMeditor.editor.prototype.init=function(){var a=!1,b,c,d,e,g,f;jQuery.browser.msie?a=new WYMeditor.WymClassExplorer(this):jQuery.browser.mozilla?a=new WYMeditor.WymClassMozilla(this):jQuery.browser.opera?a=new WYMeditor.WymClassOpera(this):jQuery.browser.safari&&(a=new WYMeditor.WymClassSafari(this));if(!1!==a){jQuery.isFunction(this._options.preInit)&&this._options.preInit(this);b=new WYMeditor.XhtmlSaxListener;jQuery.extend(b,a);this.parser=new WYMeditor.XhtmlParser(b);(this._options.styles||this._options.stylesheet)&&
this.configureEditorUsingRawCss();this.helper=new WYMeditor.XmlHelper;for(c in a)this[c]=a[c];this._box=jQuery(this._element).hide().after(this._options.boxHtml).next().addClass("wym_box_"+this._index);jQuery.isFunction(jQuery.fn.data)&&(jQuery.data(this._box.get(0),WYMeditor.WYM_INDEX,this._index),jQuery.data(this._element.get(0),WYMeditor.WYM_INDEX,this._index));a=WYMeditor.Helper;c=this._options.iframeHtml;c=a.replaceAll(c,WYMeditor.INDEX,this._index);c=a.replaceAll(c,WYMeditor.IFRAME_BASE_PATH,
this._options.iframeBasePath);b=jQuery(this._box).html();b=a.replaceAll(b,WYMeditor.LOGO,this._options.logoHtml);b=a.replaceAll(b,WYMeditor.TOOLS,this._options.toolsHtml);b=a.replaceAll(b,WYMeditor.CONTAINERS,this._options.containersHtml);b=a.replaceAll(b,WYMeditor.CLASSES,this._options.classesHtml);b=a.replaceAll(b,WYMeditor.HTML,this._options.htmlHtml);b=a.replaceAll(b,WYMeditor.IFRAME,c);b=a.replaceAll(b,WYMeditor.STATUS,this._options.statusHtml);d=eval(this._options.toolsItems);e="";for(c=0;c<
d.length;c+=1)g=d[c],f="",g.name&&g.title&&(f=this._options.toolsItemHtml),f=a.replaceAll(f,WYMeditor.TOOL_NAME,g.name),f=a.replaceAll(f,WYMeditor.TOOL_TITLE,this._options.stringDelimiterLeft+g.title+this._options.stringDelimiterRight),f=a.replaceAll(f,WYMeditor.TOOL_CLASS,g.css),e+=f;b=a.replaceAll(b,WYMeditor.TOOLS_ITEMS,e);d=eval(this._options.classesItems);e="";for(c=0;c<d.length;c+=1)g=d[c],f="",g.name&&g.title&&(f=this._options.classesItemHtml),f=a.replaceAll(f,WYMeditor.CLASS_NAME,g.name),
f=a.replaceAll(f,WYMeditor.CLASS_TITLE,g.title),e+=f;b=a.replaceAll(b,WYMeditor.CLASSES_ITEMS,e);d=eval(this._options.containersItems);e="";for(c=0;c<d.length;c+=1)f=d[c],g="",f.name&&f.title&&(g=this._options.containersItemHtml),g=a.replaceAll(g,WYMeditor.CONTAINER_NAME,f.name),g=a.replaceAll(g,WYMeditor.CONTAINER_TITLE,this._options.stringDelimiterLeft+f.title+this._options.stringDelimiterRight),g=a.replaceAll(g,WYMeditor.CONTAINER_CLASS,f.css),e+=g;b=a.replaceAll(b,WYMeditor.CONTAINERS_ITEMS,e);
b=this.replaceStrings(b);jQuery(this._box).html(b);jQuery(this._box).find(this._options.htmlSelector).hide();this.loadSkin()}};
WYMeditor.editor.prototype.bindEvents=function(){var a=this,b;jQuery(this._box).find(this._options.toolSelector).click(function(){a._iframe.contentWindow.focus();a.exec(jQuery(this).attr(WYMeditor.NAME));return!1});jQuery(this._box).find(this._options.containerSelector).click(function(){a.container(jQuery(this).attr(WYMeditor.NAME));return!1});b=jQuery(this._box).find(this._options.htmlValSelector);b.keyup(function(){jQuery(a._doc.body).html(jQuery(this).val())});b.focus(function(){jQuery(this).toggleClass("hasfocus")});
b.blur(function(){jQuery(this).toggleClass("hasfocus")});jQuery(this._box).find(this._options.classSelector).click(function(){var b=eval(a._options.classesItems),d=jQuery(this).attr(WYMeditor.NAME);if(b=WYMeditor.Helper.findByName(b,d))b=b.expr,a.toggleClass(d,b);a._iframe.contentWindow.focus();return!1});jQuery(this._options.updateSelector).bind(this._options.updateEvent,function(){a.update()})};WYMeditor.editor.prototype.ready=function(){return null!==this._doc};WYMeditor.editor.prototype.box=function(){return this._box};
WYMeditor.editor.prototype.html=function(a){if("string"===typeof a)jQuery(this._doc.body).html(a),this.update();else return jQuery(this._doc.body).html()};WYMeditor.editor.prototype.xhtml=function(){jQuery(this._doc.body).children(WYMeditor.BR).remove();return this.parser.parse(this.html())};
WYMeditor.editor.prototype.exec=function(a){var b,c,d=this;switch(a){case WYMeditor.CREATE_LINK:((b=this.container())||this._selected_image)&&this.dialog(WYMeditor.DIALOG_LINK);break;case WYMeditor.INSERT_IMAGE:this.dialog(WYMeditor.DIALOG_IMAGE);break;case WYMeditor.INSERT_TABLE:this.dialog(WYMeditor.DIALOG_TABLE);break;case WYMeditor.PASTE:this.dialog(WYMeditor.DIALOG_PASTE);break;case WYMeditor.TOGGLE_HTML:this.update();this.toggleHtml();break;case WYMeditor.PREVIEW:this.dialog(WYMeditor.PREVIEW,
this._options.dialogFeaturesPreview);break;case WYMeditor.INSERT_ORDEREDLIST:this.insertOrderedlist();break;case WYMeditor.INSERT_UNORDEREDLIST:this.insertUnorderedlist();break;case WYMeditor.INDENT:this.indent();break;case WYMeditor.OUTDENT:this.outdent();break;default:c=!1,jQuery.each(this._options.customCommands,function(){if(a===this.name)return c=!0,this.run.apply(d),!1}),c||this._exec(a)}};WYMeditor.editor.prototype.selection=function(){window.rangy&&!rangy.initialized&&rangy.init();return rangy.getIframeSelection(this._iframe)};
WYMeditor.editor.prototype.selected=function(){var a=this.selection(),b=a.focusNode;return b?(jQuery.browser.msie&&a.isCollapsed&&b.tagName&&"body"===b.tagName.toLowerCase()&&(a=this._iframe.contentWindow.document.caretPos)&&a.parentElement&&(b=a.parentElement()),"#text"===b.nodeName?b.parentNode:b):null};WYMeditor.editor.prototype.selection_collapsed=function(){var a=this.selection(),b=!1;jQuery.each(a.getAllRanges(),function(){if(this.collapsed)return b=!0,!1});return b};
WYMeditor.editor.prototype.selected_contains=function(a){var b=this.selection(),c=[];jQuery.each(b.getAllRanges(),function(){jQuery.each(this.getNodes(),function(){jQuery(this).is(a)&&c.push(this)})});return c};WYMeditor.editor.prototype.selected_parents_contains=function(a){var b=jQuery([]),c=jQuery(this.selected());c.is(a)&&(b=b.add(c));return b=b.add(c.parents(a))};
WYMeditor.editor.prototype.container=function(a){if("undefined"===typeof a)return this.selected();var b=null,c=null,d=null,d=null,e;if(a.toLowerCase()===WYMeditor.TH){b=this.container();switch(b.tagName.toLowerCase()){case WYMeditor.TD:case WYMeditor.TH:break;default:c=[WYMeditor.TD,WYMeditor.TH],b=this.findUp(this.container(),c)}null!==b&&(a=WYMeditor.TD,b.tagName.toLowerCase()===WYMeditor.TD&&(a=WYMeditor.TH),this.switchTo(b,a),this.update())}else if(c=[WYMeditor.P,WYMeditor.H1,WYMeditor.H2,WYMeditor.H3,
WYMeditor.H4,WYMeditor.H5,WYMeditor.H6,WYMeditor.PRE,WYMeditor.BLOCKQUOTE],b=this.findUp(this.container(),c)){if(a.toLowerCase()===WYMeditor.BLOCKQUOTE)if(c=this.findUp(this.container(),WYMeditor.BLOCKQUOTE),null===c)d=this._doc.createElement(a),b.parentNode.insertBefore(d,b),d.appendChild(b),this.setFocusToNode(d.firstChild);else{a=c.childNodes;b=a.length;0<b&&(d=a.item(0));for(e=0;e<b;e+=1)c.parentNode.insertBefore(a.item(0),c);c.parentNode.removeChild(c);d&&this.setFocusToNode(d)}else this.switchTo(b,
a);this.update()}return!1};WYMeditor.editor.prototype.toggleClass=function(a,b){var c=null,c=this._selected_image?this._selected_image:jQuery(this.selected()),c=jQuery(c).parentsOrSelf(b);jQuery(c).toggleClass(a);jQuery(c).attr(WYMeditor.CLASS)||jQuery(c).removeAttr(this._class)};
WYMeditor.editor.prototype.findUp=function(a,b){if("undefined"===typeof a||null===a)return null;"#text"===a.nodeName&&(a=a.parentNode);var c=a.tagName.toLowerCase(),d,e;if(typeof b===WYMeditor.STRING)for(;c!==b&&c!==WYMeditor.BODY;)a=a.parentNode,c=a.tagName.toLowerCase();else for(d=!1;!d&&c!==WYMeditor.BODY;){for(e=0;e<b.length;e+=1)if(c===b[e]){d=!0;break}if(!d){a=a.parentNode;if(null===a)return null;c=a.tagName.toLowerCase()}}return c===WYMeditor.BODY?null:a};
WYMeditor.editor.prototype.switchTo=function(a,b){var c=this._doc.createElement(b),d=jQuery(a).html();a.parentNode.replaceChild(c,a);jQuery(c).html(d);this.setFocusToNode(c)};
WYMeditor.editor.prototype.replaceStrings=function(a){var b;if(!WYMeditor.STRINGS[this._options.lang])try{eval(jQuery.ajax({url:this._options.langPath+this._options.lang+".js",async:!1}).responseText)}catch(c){return WYMeditor.console.error("WYMeditor: error while parsing language file."),a}for(b in WYMeditor.STRINGS[this._options.lang])WYMeditor.STRINGS[this._options.lang].hasOwnProperty(b)&&(a=WYMeditor.Helper.replaceAll(a,this._options.stringDelimiterLeft+b+this._options.stringDelimiterRight,WYMeditor.STRINGS[this._options.lang][b]));
return a};WYMeditor.editor.prototype.encloseString=function(a){return this._options.stringDelimiterLeft+a+this._options.stringDelimiterRight};WYMeditor.editor.prototype.status=function(a){jQuery(this._box).find(this._options.statusSelector).html(a)};WYMeditor.editor.prototype.update=function(){var a;jQuery(this._doc.body).children(WYMeditor.BR).remove();a=this.xhtml();jQuery(this._element).val(a);jQuery(this._box).find(this._options.htmlValSelector).not(".hasfocus").val(a);this.fixBodyHtml()};
WYMeditor.editor.prototype.fixBodyHtml=function(){this.fixDoubleBr();this.spaceBlockingElements()};WYMeditor.editor.prototype.spaceBlockingElements=function(){var a=WYMeditor.BLOCKING_ELEMENTS.join(", "),b=jQuery(this._doc).find("body.wym_iframe"),c=b.children(),d;0<c.length&&(d=jQuery(c[0]),c=jQuery(c[c.length-1]),d.is(a)&&d.before('<br _moz_editor_bogus_node="TRUE" _moz_dirty="">'),c.is(a)&&c.after('<br _moz_editor_bogus_node="TRUE" _moz_dirty="">'));a=this._getBlockSepSelector();b.find(a).before('<br _moz_editor_bogus_node="TRUE" _moz_dirty="">')};
WYMeditor.editor.prototype._getBlockSepSelector=function(){if("undefined"!==typeof this._blockSpacersSel)return this._blockSpacersSel;var a=[];jQuery.each(WYMeditor.BLOCKING_ELEMENTS,function(b,c){jQuery.each(WYMeditor.BLOCKING_ELEMENTS,function(b,e){a.push(c+" + "+e)})});jQuery.each(WYMeditor.BLOCKING_ELEMENTS,function(b,c){jQuery.each(WYMeditor.NON_BLOCKING_ELEMENTS,function(b,e){a.push(c+" + "+e);a.push(e+" + "+c)})});return this._blockSpacersSel=a.join(", ")};
WYMeditor.editor.prototype.fixDoubleBr=function(){var a=jQuery(this._doc).find("body.wym_iframe");a.children("br + br").filter(":not(pre br)").remove();a.find("p + br").next("p").prev("br").remove();a=a.find("p + br").slice(-1);0<a.length&&0===a.next().length&&a.remove()};
WYMeditor.editor.prototype.dialog=function(a,b,c){var b=window.open("","dialog",b||this._wym._options.dialogFeatures),d,e=WYMeditor.Helper;if(b){switch(a){case WYMeditor.DIALOG_LINK:d=this._options.dialogLinkHtml;break;case WYMeditor.DIALOG_IMAGE:d=this._options.dialogImageHtml;break;case WYMeditor.DIALOG_TABLE:d=this._options.dialogTableHtml;break;case WYMeditor.DIALOG_PASTE:d=this._options.dialogPasteHtml;break;case WYMeditor.PREVIEW:d=this._options.dialogPreviewHtml;break;default:d=c}c=this._options.dialogHtml;
c=e.replaceAll(c,WYMeditor.BASE_PATH,this._options.basePath);c=e.replaceAll(c,WYMeditor.DIRECTION,this._options.direction);c=e.replaceAll(c,WYMeditor.CSS_PATH,this._options.skinPath+WYMeditor.SKINS_DEFAULT_CSS);c=e.replaceAll(c,WYMeditor.WYM_PATH,this._options.wymPath);c=e.replaceAll(c,WYMeditor.JQUERY_PATH,this._options.jQueryPath);c=e.replaceAll(c,WYMeditor.DIALOG_TITLE,this.encloseString(a));c=e.replaceAll(c,WYMeditor.DIALOG_BODY,d);c=e.replaceAll(c,WYMeditor.INDEX,this._index);c=this.replaceStrings(c);
a=b.document;a.write(c);a.close()}};WYMeditor.editor.prototype.toggleHtml=function(){jQuery(this._box).find(this._options.htmlSelector).toggle()};WYMeditor.editor.prototype.uniqueStamp=function(){return"wym-"+(new Date).getTime()};
WYMeditor.editor.prototype._handleMultilineBlockContainerPaste=function(a,b,c,d){var e,g,f,n,l,x;$insertAfter=jQuery(l);e="p";b.is("li")&&(e="li");c.splitBoundaries();l=a.findUp(c.startContainer,"p h1 h2 h3 h4 h5 h6 li".split(" "));x=l.tagName;g=[];f=[];jQuery(l).contents().each(function(a,b){n=c.compareNode(b);n===c.NODE_BEFORE||n===c.NODE_BEFORE_AND_AFTER&&c.startOffset===c.startContainer.length?g.push(b):f.push(b)});for(b=0;b<g.length;b++)jQuery(g[b]).remove();for(b=0;b<f.length;b++)jQuery(f[b]).remove();
0<g.length&&jQuery(l).prepend(g);0<f.length&&(b=jQuery("<"+x+"></"+x+">",a._doc),b.insertAfter(jQuery(l)),b.append(f));b=d.splice(0,1)[0].split(WYMeditor.NEWLINE).join("<br />");jQuery(l).html(jQuery(l).html()+b);$insertAfter=jQuery(l);for(b=0;b<d.length;b++)html="<"+e+">"+d[b].split(WYMeditor.NEWLINE).join("<br />")+"</"+e+">",$insertAfter=jQuery(html,a._doc).insertAfter($insertAfter)};
WYMeditor.editor.prototype.paste=function(a){var b=this.selected(),c;c="";var d=!1,e;e=rangy.getIframeSelection(this._iframe).getRangeAt(0);c=jQuery(b);e.collapse(!0);paragraphStrings=a.split(RegExp(WYMeditor.NEWLINE+"{2,}","g"));1===paragraphStrings.length&&(d=!0);if("undefined"===typeof b||b&&b.tagName.toLowerCase()===WYMeditor.BODY)if(d)jQuery("<p>"+paragraphStrings[0]+"</p>",this._doc).appendTo(this._doc.body);else{blockSplitter="p";for(a=paragraphStrings.length-1;0<=a;a-=1){c="<"+blockSplitter+
">"+paragraphStrings[a].split(WYMeditor.NEWLINE).join("<br />")+"</"+blockSplitter+">";b=jQuery(c,this._doc);for(j=b.length-1;0<=j;j--)e.insertNode(b[j])}}else if(d||c.is("pre"))b=this._doc.createTextNode(a),e.insertNode(b);else if(c.is("p,h1,h2,h3,h4,h5,h6,li"))this._handleMultilineBlockContainerPaste(this,c,e,paragraphStrings);else{textNodesToInsert=a.split(WYMeditor.NEWLINE);for(a=textNodesToInsert.length-1;0<=a;a-=1)b=this._doc.createTextNode(textNodesToInsert[a]),e.insertNode(b),0<a&&e.insertNode(jQuery("<br />",
this._doc).get(0))}};WYMeditor.editor.prototype.insert=function(a){var b=this._iframe.contentWindow.getSelection();null!==b.focusNode?(b=b.getRangeAt(0),a=b.createContextualFragment(a),b.deleteContents(),b.insertNode(a)):this.paste(a)};WYMeditor.editor.prototype.wrap=function(a,b){this.insert(a+this._iframe.contentWindow.getSelection().toString()+b)};WYMeditor.editor.prototype.unwrap=function(){this.insert(this._iframe.contentWindow.getSelection().toString())};
WYMeditor.editor.prototype.setFocusToNode=function(a,b){var c=this._doc.createRange(),d=this._iframe.contentWindow.getSelection(),b=b?0:1;c.selectNodeContents(a);d.addRange(c);d.collapse(a,b);this._iframe.contentWindow.focus()};WYMeditor.editor.prototype.addCssRules=function(a,b){var c=a.styleSheets[0],d,e;if(c)for(d=0;d<b.length;d+=1)e=b[d],e.name&&e.css&&this.addCssRule(c,e)};
WYMeditor.editor.prototype.splitListItemContents=function(a){var b,c,d=!1,e={itemContents:[],sublistContents:[]},a=a.contents();for(b=0;b<a.length;b++)c=a.get(b),d||jQuery(c).is("ol,ul")?(d=!0,e.sublistContents.push(c)):e.itemContents.push(c);return e};WYMeditor.editor.prototype.joinAdjacentLists=function(a,b){var c;"undefined"===typeof a||"undefined"===typeof b||a.nextSibling!==b||a.tagName.toLowerCase()!==b.tagName.toLowerCase()||(c=jQuery(b).contents(),c.unwrap(),c.detach(),jQuery(a).append(c))};
WYMeditor.editor.prototype._indentSingleItem=function(a){var b,c,d,e,a=jQuery(a);b=a.parent()[0].tagName.toLowerCase();c=this.splitListItemContents(a);d=jQuery(c.sublistContents);jQuery(c.itemContents);e=a.prev().filter("li");0===e.length&&(a.before('<li class="spacer_li"></li>'),e=a.prev());c=e.contents().last().filter("ol,ul");0<c.length?(c.append(a),d.detach(),e.append(d),b=d.first(),this.joinAdjacentLists(c.get(0),b.get(0))):(0<d.length?(d.detach(),e.append(d),c=d.first()):(e.append("<"+b+"></"+
b+">"),c=e.contents().last()),c.prepend(a));a.next().is(".spacer_li")&&(b=a.next(".spacer_li"),d=b.contents(),d.detach(),a.append(d),b.remove())};
WYMeditor.editor.prototype._outdentSingleItem=function(a){var b,c,d,e,g,f,n;b=jQuery(a);c=b.parent()[0].tagName.toLowerCase();b.parent().parent().is("ol,ul,li")&&((b.parent().parent().is("li")||(WYMeditor.console.log("Attempting to fix invalid list nesting before outdenting."),this.correctInvalidListNesting(a)),d=this.splitListItemContents(b),a=jQuery(d.sublistContents),jQuery(d.itemContents),d=b.parent().parent("li"),0===d.length)?WYMeditor.console.error("Invalid list. No parentLi found, so aborting outdent"):
(e=b.parent(),g=b.nextAllContents(),f=e.nextAllContents(),b.detach(),d.after(b),0<a.length&&(b.append("<"+c+'><li class="spacer_li"></li></'+c+">"),n=b.children().last(),a.detach(),n.children("li").append(a)),0<g.length&&("undefined"===typeof n&&(b.append("<"+c+"></"+c+">"),n=b.children().last()),g.detach(),n.append(g)),0<f.length&&(f.detach(),0<b.contents().length&&(b.contents().last()[0].nodeType===WYMeditor.NODE.TEXT&&f[0].nodeType===WYMeditor.NODE.TEXT)&&b.append("<br />"),b.append(f)),0===e.contents().length&&
e.remove(),0===d.contents().length&&d.remove()))};
WYMeditor.editor.prototype.correctInvalidListNesting=function(a,b){var c=a,d,e;"undefined"===typeof b&&(b=!1);if(!c)return b;for(;c.parentNode;){d=c.parentNode;if(d.nodeType!==WYMeditor.NODE.ELEMENT)break;e=d.tagName.toLowerCase();if("ol"!==e&&"ul"!==e&&"li"!==e)break;c=d}return jQuery(c).is("li")?(WYMeditor.console.log("Correcting orphaned root li before correcting invalid list nesting."),this._correctOrphanedListItem(c),this.correctInvalidListNesting(c,!0)):!jQuery(c).is("ol,ul")?(WYMeditor.console.error("Can't correct invalid list nesting. No root list found"),
b):this._correctInvalidListNesting(c,b)};WYMeditor.editor.prototype._correctOrphanedListItem=function(a){var b,c,d=jQuery();b=jQuery(a).prevContentsUntil(":not(li)");c=jQuery(a).nextContentsUntil(":not(li)");d=d.add(b);d=d.add(a);d=d.add(c);a=d[0].previousSibling;if(!a||!jQuery(a).is("ol,ul"))d.before("<ol></ol>"),a=d.prev()[0];jQuery(a).append(d)};
WYMeditor.editor.prototype._correctInvalidListNesting=function(a,b){var c=a,d=!1,e,g,f;for("undefined"!==typeof b&&(d=b);c;)if(c._wym_visited){c._wym_visited=!1;if(c===a)break;c=c.previousSibling?c.previousSibling:c.parentNode}else{if(c!==a&&!jQuery(c).is("li"))for(f=c;f.parentNode;){f=f.parentNode;if(jQuery(f).is("li"))break;if(f.nodeType!==WYMeditor.NODE.ELEMENT)break;g=f.tagName.toLowerCase();if("ol"===g||"ul"===g){WYMeditor.console.log("Fixing orphaned list content");d=!0;g=[c];e=c;for(f=null;e.previousSibling;){e=
e.previousSibling;if(jQuery(e).is("li")){f=e;break}g.push(e)}g.reverse();!f&&1===g.length&&jQuery(c.nextSibling).is("li")&&(f=c.nextSibling);f||(jQuery(g[0]).before('<li class="spacer_li"></li>'),f=jQuery(g[0]).prev()[0]);e=jQuery(f).contents().last();1===e.length&&e[0].nodeType===WYMeditor.NODE.TEXT&&g[0].nodeType===WYMeditor.NODE.TEXT&&jQuery(f).append("<br />");jQuery(f).append(jQuery(g));break}}c.lastChild?(c._wym_visited=!0,c=c.lastChild):c=c.previousSibling?c.previousSibling:c.parentNode}return d};
WYMeditor.editor.prototype.getCommonParentList=function(a){var b,c,a=jQuery(a).filter("li");if(0===a.length)return null;b=jQuery(a[0]).parent("ol,ul");if(0===b.length)return null;c=b[0];jQuery(a).each(function(a,e){b=jQuery(e).parent("ol,ul");if(0===b.length||b[0]!==c)return null});return c};
WYMeditor.editor.prototype._getSelectedListItems=function(a){var b,c,d,e=[],g=[],f,n;f=function(a){var b;if(rangy.dom.isCharacterDataNode(a))return a;try{b=c.containsNodeText(a)}catch(d){return!0}if(!0===b)return!0};for(b=0;b<a.rangeCount;b++)if(c=a.getRangeAt(b),!0===c.collapsed)(d=this.findUp(c.startContainer,"li"))&&(e=e.concat([d]));else{e=e.concat(c.getNodes([],f));d=[];for(j=0;j<e.length;j++)if(n=e[j],!jQuery(n).is("li,ol,ul"))for(;n.parentNode;)if(n=n.parentNode,jQuery(n).is("li")){d.push(n);
break}for(j=0;j<d.length;j++)-1===jQuery.inArray(d[j],e)&&e.push(d[j])}for(b=0;b<e.length;b++)e[b].nodeType===WYMeditor.NODE.ELEMENT&&e[b].tagName.toLowerCase()===WYMeditor.LI&&g.push(e[b]);return g};
WYMeditor.editor.prototype.indent=function(){var a=this._wym,b=rangy.getIframeSelection(this._iframe),c;if(a.restoreSelectionAfterManipulation(function(){var b=a.selected(),b=a.findUp(b,["ol","ul","li"]);return a.correctInvalidListNesting(b)}))return!0;b=rangy.getIframeSelection(this._iframe);c=a._getSelectedListItems(b);return 0===c.length||null===a.getCommonParentList(c)?!1:a.restoreSelectionAfterManipulation(function(){var b=false;for(i=0;i<c.length;i++){a._indentSingleItem(c[i]);b=true}return b})};
WYMeditor.editor.prototype.outdent=function(){var a=this._wym,b=rangy.getIframeSelection(this._iframe),c;if(a.restoreSelectionAfterManipulation(function(){var b=a.selected(),b=a.findUp(b,["ol","ul","li"]);return a.correctInvalidListNesting(b)}))return!0;b=rangy.getIframeSelection(this._iframe);c=a._getSelectedListItems(b);return 0===c.length||null===a.getCommonParentList(c)?!1:a.restoreSelectionAfterManipulation(function(){var b=false;for(i=0;i<c.length;i++){a._outdentSingleItem(c[i]);b=true}return b})};
WYMeditor.editor.prototype.restoreSelectionAfterManipulation=function(a){rangy.getIframeSelection(this._iframe);var b=rangy.saveSelection(rangy.dom.getIframeWindow(this._iframe)),c=!0;try{(c=a())?rangy.restoreSelection(b):rangy.removeMarkers(b)}catch(d){WYMeditor.console.error("Error during manipulation"),WYMeditor.console.error(d),rangy.removeMarkers(b)}return c};
WYMeditor.editor.prototype.insertOrderedlist=function(){var a=this;return a.restoreSelectionAfterManipulation(function(){var b=a.selected(),b=a.findUp(b,["ol","ul","li"]);return a.correctInvalidListNesting(b)})?!0:a.restoreSelectionAfterManipulation(function(){return a._insertList("ol")})};
WYMeditor.editor.prototype.insertUnorderedlist=function(){var a=this;return a.restoreSelectionAfterManipulation(function(){var b=a.selected(),b=a.findUp(b,["ol","ul","li"]);return a.correctInvalidListNesting(b)})?!0:a.restoreSelectionAfterManipulation(function(){return a._insertList("ul")})};
WYMeditor.editor.prototype._insertList=function(a){var b=this._wym,c=rangy.getIframeSelection(this._iframe),c=b._getSelectedListItems(c);if(0!==c.length)return(b=b.getCommonParentList(c))?(this._changeListType(b,a),!0):!1;b=this.selected();return(b=this.findUp(b,WYMeditor.POTENTIAL_LIST_ELEMENTS))?(this._convertToList(b,a),!0):!1};WYMeditor.editor.prototype._changeListType=function(a,b){return WYMeditor.changeNodeType(a,b)};
WYMeditor.editor.prototype._convertToList=function(a,b){var c=jQuery(a),d;d="<"+b+"><li></li></"+b+">";if(this.findUp(a,WYMeditor.MAIN_CONTAINERS)===a)return c.wrapInner(d),c=c.children(),c.unwrap(),c.get(0);c.wrapInner(d);c=c.children();return c.get(0)};
WYMeditor.editor.prototype.insertTable=function(a,b,c,d){if(!(0>=a||0>=b)){var e=this._doc.createElement(WYMeditor.TABLE),g=null,f;e.createCaption().innerHTML=c;for(c=0;c<a;c+=1){g=e.insertRow(c);for(f=0;f<b;f+=1)g.insertCell(f)}""!==d&&jQuery(e).attr("summary",d);a=jQuery(this.findUp(this.container(),WYMeditor.MAIN_CONTAINERS)).get(0);!a||!a.parentNode?jQuery(this._doc.body).append(e):jQuery(a).after(e);this.afterInsertTable(e);this.fixBodyHtml();return e}};
WYMeditor.editor.prototype.afterInsertTable=function(){};
WYMeditor.editor.prototype.configureEditorUsingRawCss=function(){var a=new WYMeditor.WymCssParser;this._options.stylesheet?a.parse(jQuery.ajax({url:this._options.stylesheet,async:!1}).responseText):a.parse(this._options.styles,!1);0===this._options.classesItems.length&&(this._options.classesItems=a.css_settings.classesItems);0===this._options.editorStyles.length&&(this._options.editorStyles=a.css_settings.editorStyles);0===this._options.dialogStyles.length&&(this._options.dialogStyles=a.css_settings.dialogStyles)};
WYMeditor.editor.prototype.listen=function(){var a=this;jQuery(this._doc.body).bind("mousedown",function(b){a.mousedown(b)})};WYMeditor.editor.prototype.mousedown=function(a){this._selected_image=null;a.target.tagName.toLowerCase()===WYMeditor.IMG&&(this._selected_image=a.target)};WYMeditor.loadCss=function(a){var b=document.createElement("link");b.rel="stylesheet";b.href=a;jQuery("head").get(0).appendChild(b)};
WYMeditor.editor.prototype.loadSkin=function(){if(this._options.loadSkin&&!WYMeditor.SKINS[this._options.skin]){var a=!1,b=RegExp(this._options.skin+"/"+WYMeditor.SKINS_DEFAULT_CSS+"$");jQuery("link").each(function(){this.href.match(b)&&(a=!0)});a||WYMeditor.loadCss(this._options.skinPath+WYMeditor.SKINS_DEFAULT_CSS)}jQuery(this._box).addClass("wym_skin_"+this._options.skin);this._options.initSkin&&!WYMeditor.SKINS[this._options.skin]&&eval(jQuery.ajax({url:this._options.skinPath+WYMeditor.SKINS_DEFAULT_JS,
async:!1}).responseText);WYMeditor.SKINS[this._options.skin]&&WYMeditor.SKINS[this._options.skin].init&&WYMeditor.SKINS[this._options.skin].init(this)};WYMeditor.WymClassExplorer=function(a){this._wym=a;this._class="className"};WYMeditor.WymClassExplorer.PLACEHOLDER_NODE="<br>";
WYMeditor.WymClassExplorer.prototype.initIframe=function(a){this._iframe=a;this._doc=a.contentWindow.document;var b=eval(this._options.editorStyles);this.addCssRules(this._doc,b);this._doc.title=this._wym._index;jQuery("html",this._doc).attr("dir",this._options.direction);jQuery(this._doc.body).html(this._wym._html);var c=this;this._doc.body.onfocus=function(){c._doc.designMode="on";c._doc=a.contentWindow.document};this._doc.onbeforedeactivate=function(){c.saveCaret()};jQuery(this._doc).bind("keyup",
c.keyup);b=parseInt(jQuery.browser.version,10);8<=b&&9>b&&jQuery(this._doc).bind("keydown",function(){c.fixBluescreenOfDeath()});this._doc.onkeyup=function(){c.saveCaret()};this._doc.onclick=function(){c.saveCaret()};this._doc.body.onbeforepaste=function(){c._iframe.contentWindow.event.returnValue=!1};this._doc.body.onpaste=function(){c._iframe.contentWindow.event.returnValue=!1;c.paste(window.clipboardData.getData("Text"))};this._initialized&&(jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),
this._wym.bindEvents(),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen());this._initialized=!0;this._doc.designMode="on";try{this._doc=a.contentWindow.document}catch(d){}};(function(a){WYMeditor.WymClassExplorer.prototype.loadSkin=function(){jQuery(this._box).find(this._options.containerSelector).attr("unselectable","on");a.call(this)}})(WYMeditor.editor.prototype.loadSkin);
WYMeditor.WymClassExplorer.prototype.fixBluescreenOfDeath=function(){var a=jQuery(this._doc).find("p").eq(0).position();null!==a&&("undefined"!==typeof a&&0>a.left)&&(jQuery(this._box).append('<br id="wym-bluescreen-bug-fix" />'),jQuery(this._box).find("#wym-bluescreen-bug-fix").remove())};WYMeditor.WymClassExplorer.prototype._exec=function(a,b){b?this._doc.execCommand(a,!1,b):this._doc.execCommand(a)};WYMeditor.WymClassExplorer.prototype.saveCaret=function(){this._doc.caretPos=this._doc.selection.createRange()};
WYMeditor.WymClassExplorer.prototype.addCssRule=function(a,b){var c=b.name.split(","),d;for(d=0;d<c.length;d++)a.addRule(c[d],b.css)};WYMeditor.WymClassExplorer.prototype.insert=function(a){var b=this._doc.selection.createRange();if(jQuery(b.parentElement()).parents().is(this._options.iframeBodySelector))try{b.pasteHTML(a)}catch(c){}else this.paste(a)};
WYMeditor.WymClassExplorer.prototype.wrap=function(a,b){var c=this._doc.selection.createRange();if(jQuery(c.parentElement()).parents().is(this._options.iframeBodySelector))try{c.pasteHTML(a+c.text+b)}catch(d){}};WYMeditor.WymClassExplorer.prototype.unwrap=function(){var a=this._doc.selection.createRange();if(jQuery(a.parentElement()).parents().is(this._options.iframeBodySelector))try{var b=a.text;this._exec("Cut");a.pasteHTML(b)}catch(c){}};
WYMeditor.WymClassExplorer.prototype.keyup=function(a){var b=WYMeditor.INSTANCES[this.title],c=this._selected_image=null;if(a.keyCode!==WYMeditor.KEY.BACKSPACE&&a.keyCode!==WYMeditor.KEY.CTRL&&a.keyCode!==WYMeditor.KEY.DELETE&&a.keyCode!==WYMeditor.KEY.COMMAND&&a.keyCode!==WYMeditor.KEY.UP&&a.keyCode!==WYMeditor.KEY.DOWN&&a.keyCode!==WYMeditor.KEY.ENTER&&!a.metaKey&&!a.ctrlKey){var c=b.selected(),d="";null!==c&&(d=c.tagName.toLowerCase());if("strong"===d||"b"===d||"em"===d||"i"===d||"sub"===d||"sup"===
d||"a"===d)d=c.parentNode.tagName.toLowerCase();d===WYMeditor.BODY&&(b._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P),b.fixBodyHtml())}(a.keyCode===WYMeditor.KEY.UP||a.keyCode===WYMeditor.KEY.DOWN||a.keyCode===WYMeditor.KEY.BACKSPACE||a.keyCode===WYMeditor.KEY.ENTER)&&b.fixBodyHtml()};WYMeditor.WymClassExplorer.prototype.setFocusToNode=function(a,b){var c=this._doc.selection.createRange(),b=b?!0:!1;c.moveToElementText(a);c.collapse(b);c.select();a.focus()};
WYMeditor.WymClassExplorer.prototype.spaceBlockingElements=function(){var a=WYMeditor.BLOCKING_ELEMENTS.join(", "),b=jQuery(this._doc).find("body.wym_iframe"),c=b.children(),d=WYMeditor.WymClassExplorer.PLACEHOLDER_NODE;if(0<c.length){var e=jQuery(c[0]),c=jQuery(c[c.length-1]);e.is(a)&&e.before(d);"7.0"<=jQuery.browser.version&&c.is(a)&&c.after(d)}a=this._getBlockSepSelector();b.find(a).before(d)};WYMeditor.WymClassMozilla=function(a){this._wym=a;this._class="class"};
WYMeditor.WymClassMozilla.CELL_PLACEHOLDER='<br _moz_dirty="">';WYMeditor.WymClassMozilla.NEEDS_CELL_FIX="1.9.1"<=jQuery.browser.version&&"2.0">jQuery.browser.version;
WYMeditor.WymClassMozilla.prototype.initIframe=function(a){var b=this;this._iframe=a;this._doc=a.contentDocument;a=eval(this._options.editorStyles);this.addCssRules(this._doc,a);this._doc.title=this._wym._index;jQuery("html",this._doc).attr("dir",this._options.direction);this.html(this._wym._html);this.enableDesignMode();jQuery.isFunction(this._options.preBind)&&this._options.preBind(this);this._wym.bindEvents();jQuery(this._doc).bind("keydown",this.keydown);jQuery(this._doc).bind("keyup",this.keyup);
jQuery(this._doc).bind("click",this.click);jQuery(this._doc).bind("focus",function(){b.enableDesignMode.call(b)});jQuery.isFunction(this._options.postInit)&&this._options.postInit(this);this.listen()};
WYMeditor.WymClassMozilla.prototype.html=function(a){if("string"===typeof a){try{this._doc.designMode="off"}catch(b){}a=a.replace(/<em(\b[^>]*)>/gi,"<i$1>");a=a.replace(/<\/em>/gi,"</i>");a=a.replace(/<strong(\b[^>]*)>/gi,"<b$1>");a=a.replace(/<\/strong>/gi,"</b>");jQuery(this._doc.body).html(a);this._wym.fixBodyHtml();this.enableDesignMode()}else return jQuery(this._doc.body).html();return!1};
WYMeditor.WymClassMozilla.prototype._exec=function(a,b){if(!this.selected())return!1;b?this._doc.execCommand(a,"",b):this._doc.execCommand(a,"",null);this.selected().tagName.toLowerCase()===WYMeditor.BODY&&this._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P);return!0};WYMeditor.WymClassMozilla.prototype.addCssRule=function(a,b){a.insertRule(b.name+" {"+b.css+"}",a.cssRules.length)};
WYMeditor.WymClassMozilla.prototype.keydown=function(a){var b=WYMeditor.INSTANCES[this.title];if(a.ctrlKey){if(66===a.keyCode)return b._exec(WYMeditor.BOLD),!1;if(73===a.keyCode)return b._exec(WYMeditor.ITALIC),!1}return!0};
WYMeditor.WymClassMozilla.prototype.keyup=function(a){var b=WYMeditor.INSTANCES[this.title],c,d;b._selected_image=null;if(a.keyCode!==WYMeditor.KEY.BACKSPACE&&a.keyCode!==WYMeditor.KEY.CTRL&&a.keyCode!==WYMeditor.KEY.DELETE&&a.keyCode!==WYMeditor.KEY.COMMAND&&a.keyCode!==WYMeditor.KEY.UP&&a.keyCode!==WYMeditor.KEY.DOWN&&a.keyCode!==WYMeditor.KEY.LEFT&&a.keyCode!==WYMeditor.KEY.RIGHT&&a.keyCode!==WYMeditor.KEY.ENTER&&!a.metaKey&&!a.ctrlKey){c=b.selected();d=c.tagName.toLowerCase();if("strong"===d||
"b"===d||"em"===d||"i"===d||"sub"===d||"sup"===d||"a"===d)d=c.parentNode.tagName.toLowerCase();d===WYMeditor.BODY&&(b._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P),b.fixBodyHtml())}(a.keyCode===WYMeditor.KEY.UP||a.keyCode===WYMeditor.KEY.DOWN||a.keyCode===WYMeditor.KEY.LEFT||a.keyCode===WYMeditor.KEY.RIGHT||a.keyCode===WYMeditor.KEY.BACKSPACE||a.keyCode===WYMeditor.KEY.ENTER)&&b.fixBodyHtml()};
WYMeditor.WymClassMozilla.prototype.click=function(){var a=WYMeditor.INSTANCES[this.title],b=a.selected();!0===WYMeditor.WymClassMozilla.NEEDS_CELL_FIX&&b&&b.tagName.toLowerCase()===WYMeditor.TR&&jQuery(WYMeditor.TD,a._doc.body).append(WYMeditor.WymClassMozilla.CELL_PLACEHOLDER);b&&b.tagName.toLowerCase()===WYMeditor.BODY&&(b=a._iframe.contentWindow.getSelection(),!0===b.isCollapsed&&a._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P))};
WYMeditor.WymClassMozilla.prototype.enableDesignMode=function(){if("off"===this._doc.designMode)try{this._doc.designMode="on",this._doc.execCommand("styleWithCSS","",!1),this._doc.execCommand("enableObjectResizing",!1,!0)}catch(a){}};WYMeditor.WymClassMozilla.prototype.openBlockTag=function(a,b){b=this.validator.getValidTagAttributes(a,b);if("span"===a&&b.style){var c=this.getTagForStyle(b.style);c&&(a=c,this._tag_stack.pop(),this._tag_stack.push(a),b.style="")}this.output+=this.helper.tag(a,b,!0)};
WYMeditor.WymClassMozilla.prototype.getTagForStyle=function(a){return/bold/.test(a)?"strong":/italic/.test(a)?"em":/sub/.test(a)?"sub":/super/.test(a)?"sup":!1};WYMeditor.WymClassMozilla.prototype.afterInsertTable=function(a){!0===WYMeditor.WymClassMozilla.NEEDS_CELL_FIX&&jQuery(a).find("td").each(function(a,c){jQuery(c).append(WYMeditor.WymClassMozilla.CELL_PLACEHOLDER)})};WYMeditor.WymClassOpera=function(a){this._wym=a;this._class="class"};
WYMeditor.WymClassOpera.prototype.initIframe=function(a){this._iframe=a;this._doc=a.contentWindow.document;a=eval(this._options.editorStyles);this.addCssRules(this._doc,a);this._doc.title=this._wym._index;jQuery("html",this._doc).attr("dir",this._options.direction);this._doc.designMode="on";this.html(this._wym._html);jQuery.isFunction(this._options.preBind)&&this._options.preBind(this);this._wym.bindEvents();jQuery(this._doc).bind("keydown",this.keydown);jQuery(this._doc).bind("keyup",this.keyup);
jQuery.isFunction(this._options.postInit)&&this._options.postInit(this);this.listen()};WYMeditor.WymClassOpera.prototype._exec=function(a,b){b?this._doc.execCommand(a,!1,b):this._doc.execCommand(a)};WYMeditor.WymClassOpera.prototype.selected=function(){var a=this._iframe.contentWindow.getSelection().focusNode;return a?"#text"==a.nodeName?a.parentNode:a:null};WYMeditor.WymClassOpera.prototype.addCssRule=function(a,b){a.insertRule(b.name+" {"+b.css+"}",a.cssRules.length)};
WYMeditor.WymClassOpera.prototype.keydown=function(a){var b=WYMeditor.INSTANCES[this.title];startNode=b._iframe.contentWindow.getSelection().getRangeAt(0).startContainer;!jQuery(startNode).parentsOrSelf(WYMeditor.MAIN_CONTAINERS.join(","))[0]&&(!jQuery(startNode).parentsOrSelf("li")&&a.keyCode!=WYMeditor.KEY.ENTER&&a.keyCode!=WYMeditor.KEY.LEFT&&a.keyCode!=WYMeditor.KEY.UP&&a.keyCode!=WYMeditor.KEY.RIGHT&&a.keyCode!=WYMeditor.KEY.DOWN&&a.keyCode!=WYMeditor.KEY.BACKSPACE&&a.keyCode!=WYMeditor.KEY.DELETE)&&
b._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)};WYMeditor.WymClassOpera.prototype.keyup=function(){WYMeditor.INSTANCES[this.title]._selected_image=null};WYMeditor.WymClassSafari=function(a){this._wym=a;this._class="class"};
WYMeditor.WymClassSafari.prototype.initIframe=function(a){this._iframe=a;this._doc=a.contentDocument;a=eval(this._options.editorStyles);this.addCssRules(this._doc,a);this._doc.title=this._wym._index;jQuery("html",this._doc).attr("dir",this._options.direction);this._doc.designMode="on";this.html(this._wym._html);jQuery.isFunction(this._options.preBind)&&this._options.preBind(this);this._wym.bindEvents();jQuery(this._doc).bind("keydown",this.keydown);jQuery(this._doc).bind("keyup",this.keyup);jQuery.isFunction(this._options.postInit)&&
this._options.postInit(this);this.listen()};
WYMeditor.WymClassSafari.prototype._exec=function(a,b){if(!this.selected())return!1;this.selected();var c,d,e;if(a.toLowerCase()==WYMeditor.INSERT_HTML.toLowerCase()&&(c=jQuery(b),c.is("div"))){e=c.get(0).attributes;this._doc.execCommand(WYMeditor.FORMAT_BLOCK,"",WYMeditor.DIV);d=this.selected();for(var g=0;g<e.length;g++)d.setAttribute(e[g].name,e[g].value);b=c.html()}b?this._doc.execCommand(a,"",b):this._doc.execCommand(a,"",null);(d=this.selected())&&d.tagName.toLowerCase()===WYMeditor.BODY&&this._exec(WYMeditor.FORMAT_BLOCK,
WYMeditor.P);return!0};WYMeditor.WymClassSafari.prototype.addCssRule=function(a,b){a.insertRule(b.name+" {"+b.css+"}",a.cssRules.length)};WYMeditor.WymClassSafari.prototype.keydown=function(a){var b=WYMeditor.INSTANCES[this.title];if(a.ctrlKey){if(a.keyCode===WYMeditor.KEY.B&&(b._exec(WYMeditor.BOLD),a.preventDefault()),a.keyCode===WYMeditor.KEY.I)b._exec(WYMeditor.ITALIC),a.preventDefault()}else a.shiftKey&&a.keyCode===WYMeditor.KEY.ENTER&&(b._exec("InsertLineBreak"),a.preventDefault())};
WYMeditor.WymClassSafari.prototype.keyup=function(a){var b=WYMeditor.INSTANCES[this.title],c,d;b._selected_image=null;534.1>jQuery.browser.version&&a.keyCode===WYMeditor.KEY.ENTER&&a.shiftKey&&b._exec("InsertLineBreak");if(a.keyCode!==WYMeditor.KEY.BACKSPACE&&a.keyCode!==WYMeditor.KEY.CTRL&&a.keyCode!==WYMeditor.KEY.DELETE&&a.keyCode!==WYMeditor.KEY.COMMAND&&a.keyCode!==WYMeditor.KEY.UP&&a.keyCode!==WYMeditor.KEY.DOWN&&a.keyCode!==WYMeditor.KEY.LEFT&&a.keyCode!==WYMeditor.KEY.RIGHT&&a.keyCode!==WYMeditor.KEY.ENTER&&
!a.metaKey&&!a.ctrlKey){c=b.selected();d=c.tagName.toLowerCase();if("strong"===d||"b"===d||"em"===d||"i"===d||"sub"===d||"sup"===d||"a"===d||"span"===d)d=c.parentNode.tagName.toLowerCase();d===WYMeditor.BODY&&(b._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P),b.fixBodyHtml())}(a.keyCode===WYMeditor.KEY.UP||a.keyCode===WYMeditor.KEY.DOWN||a.keyCode===WYMeditor.KEY.LEFT||a.keyCode===WYMeditor.KEY.RIGHT||a.keyCode===WYMeditor.KEY.BACKSPACE||a.keyCode===WYMeditor.KEY.ENTER)&&b.fixBodyHtml()};
WYMeditor.WymClassSafari.prototype.openBlockTag=function(a,b){var c,b=this.validator.getValidTagAttributes(a,b);if("span"===a&&b.style&&(c=this.getTagForStyle(b.style)))a=c,this._tag_stack.pop(),this._tag_stack.push(a),b.style="","string"===typeof b["class"]&&(b["class"]=b["class"].replace(/apple-style-span/gi,""));this.output+=this.helper.tag(a,b,!0)};
WYMeditor.WymClassSafari.prototype.getTagForStyle=function(a){return/bold/.test(a)?"strong":/italic/.test(a)?"em":/sub/.test(a)?"sub":/super/.test(a)?"sup":!1};WYMeditor.XmlHelper=function(){this._entitiesDiv=document.createElement("div");return this};WYMeditor.XmlHelper.prototype.tag=function(a,b,c){b=b||!1;c=c||!1;return"<"+a+(b?this.tagOptions(b):"")+(c?">":" />")};WYMeditor.XmlHelper.prototype.contentTag=function(a,b,c){c=c||!1;return"<"+a+(c?this.tagOptions(c):"")+">"+b+"</"+a+">"};
WYMeditor.XmlHelper.prototype.cdataSection=function(a){return"<![CDATA["+a+"]]\>"};WYMeditor.XmlHelper.prototype.escapeOnce=function(a){return this._fixDoubleEscape(this.escapeEntities(a))};WYMeditor.XmlHelper.prototype._fixDoubleEscape=function(a){return a.replace(/&amp;([a-z]+|(#\d+));/ig,"&$1;")};
WYMeditor.XmlHelper.prototype.tagOptions=function(a){this._formated_options="";for(var b in a){var c=a[b];if("function"!=typeof c&&0<c.length&&(parseInt(b,10)==b&&"object"==typeof c&&(b=c.shift(),c=c.pop()),""!==b&&""!==c))this._formated_options+=" "+b+'="'+this.escapeOnce(c)+'"'}return this._formated_options};
WYMeditor.XmlHelper.prototype.escapeEntities=function(a,b){this._entitiesDiv.innerHTML=a;this._entitiesDiv.textContent=a;var c=this._entitiesDiv.innerHTML;"undefined"==typeof b&&(!1!==b&&(c=c.replace('"',"&quot;")),!0===b&&(c=c.replace('"',"&#039;")));return c};
WYMeditor.XmlHelper.prototype.parseAttributes=function(a){var b=[],c=a.split(/((=\s*")(")("))|((=\s*\')(\')(\'))|((=\s*[^>\s]*))/g);if(c.toString()!=a)for(var d in c){var e=c[d];if("function"!=typeof e&&0!==e.length){var g=a.match(RegExp("(\\w+)\\s*"+e));if(g){var e=e.replace(/^[\s=]+/,""),f=e.charAt(0),f='"'==f?'"':"'"==f?"'":"";""!==f&&(e='"'==f?e.replace(/^"|"+$/g,""):e.replace(/^'|'+$/g,""));a=a.replace(g[0],"");b.push([g[1],e])}}}return b};
WYMeditor.XhtmlValidator={_attributes:{core:{except:"base head html meta param script style title".split(" "),attributes:"class id style title accesskey tabindex /^data-.*/".split(" ")},language:{except:"base br hr iframe param script".split(" "),attributes:{dir:["ltr","rtl"],"0":"lang",1:"xml:lang"}},keyboard:{attributes:{accesskey:/^(\w){1}$/,tabindex:/^(\d)+$/}}},_events:{window:{only:["body"],attributes:["onload","onunload"]},form:{only:"form input textarea select a label button".split(" "),attributes:"onchange onsubmit onreset onselect onblur onfocus".split(" ")},
keyboard:{except:"base bdo br frame frameset head html iframe meta param script style title".split(" "),attributes:["onkeydown","onkeypress","onkeyup"]},mouse:{except:"base bdo br head html meta param script style title".split(" "),attributes:"onclick ondblclick onmousedown onmousemove onmouseover onmouseout onmouseup".split(" ")}},_tags:{a:{attributes:{"0":"charset",1:"coords",2:"href",3:"hreflang",4:"name",5:"rel",6:"rev",shape:/^(rect|rectangle|circ|circle|poly|polygon)$/,7:"type"}},"0":"abbr",
1:"acronym",2:"address",area:{attributes:{"0":"alt",1:"coords",2:"href",nohref:/^(true|false)$/,shape:/^(rect|rectangle|circ|circle|poly|polygon)$/},required:["alt"]},3:"b",base:{attributes:["href"],required:["href"]},bdo:{attributes:{dir:/^(ltr|rtl)$/},required:["dir"]},4:"big",blockquote:{attributes:["cite"]},5:"body",6:"br",button:{attributes:{disabled:/^(disabled)$/,type:/^(button|reset|submit)$/,"0":"value"},inside:"form"},7:"caption",8:"cite",9:"code",col:{attributes:{align:/^(right|left|center|justify)$/,
"0":"char",1:"charoff",span:/^(\d)+$/,valign:/^(top|middle|bottom|baseline)$/,2:"width"},inside:"colgroup"},colgroup:{attributes:{align:/^(right|left|center|justify)$/,"0":"char",1:"charoff",span:/^(\d)+$/,valign:/^(top|middle|bottom|baseline)$/,2:"width"}},10:"dd",del:{attributes:{"0":"cite",datetime:/^([0-9]){8}/}},11:"div",12:"dfn",13:"dl",14:"dt",15:"em",fieldset:{inside:"form"},form:{attributes:{"0":"action",1:"accept",2:"accept-charset",3:"enctype",method:/^(get|post)$/},required:["action"]},
head:{attributes:["profile"]},16:"h1",17:"h2",18:"h3",19:"h4",20:"h5",21:"h6",22:"hr",html:{attributes:["xmlns"]},23:"i",img:{attributes:"alt src height ismap longdesc usemap width".split(" "),required:["alt","src"]},input:{attributes:{"0":"accept",1:"alt",checked:/^(checked)$/,disabled:/^(disabled)$/,maxlength:/^(\d)+$/,2:"name",readonly:/^(readonly)$/,size:/^(\d)+$/,3:"src",type:/^(button|checkbox|file|hidden|image|password|radio|reset|submit|text)$/,4:"value"},inside:"form"},ins:{attributes:{"0":"cite",
datetime:/^([0-9]){8}/}},24:"kbd",label:{attributes:["for"],inside:"form"},25:"legend",26:"li",link:{attributes:{"0":"charset",1:"href",2:"hreflang",media:/^(all|braille|print|projection|screen|speech|,|;| )+$/i,rel:/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,rev:/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,
3:"type"},inside:"head"},map:{attributes:["id","name"],required:["id"]},meta:{attributes:{"0":"content","http-equiv":/^(content\-type|expires|refresh|set\-cookie)$/i,1:"name",2:"scheme"},required:["content"]},27:"noscript",object:{attributes:"archive classid codebase codetype data declare height name standby type usemap width".split(" ")},28:"ol",optgroup:{attributes:{"0":"label",disabled:/^(disabled)$/},required:["label"]},option:{attributes:{"0":"label",disabled:/^(disabled)$/,selected:/^(selected)$/,
1:"value"},inside:"select"},29:"p",param:{attributes:{"0":"type",valuetype:/^(data|ref|object)$/,1:"valuetype",2:"value"},required:["name"]},30:"pre",q:{attributes:["cite"]},31:"samp",script:{attributes:{type:/^(text\/ecmascript|text\/javascript|text\/jscript|text\/vbscript|text\/vbs|text\/xml)$/,"0":"charset",defer:/^(defer)$/,1:"src"},required:["type"]},select:{attributes:{disabled:/^(disabled)$/,multiple:/^(multiple)$/,"0":"name",1:"size"},inside:"form"},32:"small",33:"span",34:"strong",style:{attributes:{"0":"type",
media:/^(screen|tty|tv|projection|handheld|print|braille|aural|all)$/},required:["type"]},35:"sub",36:"sup",table:{attributes:{"0":"border",1:"cellpadding",2:"cellspacing",frame:/^(void|above|below|hsides|lhs|rhs|vsides|box|border)$/,rules:/^(none|groups|rows|cols|all)$/,3:"summary",4:"width"}},tbody:{attributes:{align:/^(right|left|center|justify)$/,"0":"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},td:{attributes:{"0":"abbr",align:/^(left|right|center|justify|char)$/,1:"axis",2:"char",
3:"charoff",colspan:/^(\d)+$/,4:"headers",rowspan:/^(\d)+$/,scope:/^(col|colgroup|row|rowgroup)$/,valign:/^(top|middle|bottom|baseline)$/}},textarea:{attributes:["cols","rows","disabled","name","readonly"],required:["cols","rows"],inside:"form"},tfoot:{attributes:{align:/^(right|left|center|justify)$/,"0":"char",1:"charoff",valign:/^(top|middle|bottom)$/,2:"baseline"}},th:{attributes:{"0":"abbr",align:/^(left|right|center|justify|char)$/,1:"axis",2:"char",3:"charoff",colspan:/^(\d)+$/,4:"headers",
rowspan:/^(\d)+$/,scope:/^(col|colgroup|row|rowgroup)$/,valign:/^(top|middle|bottom|baseline)$/}},thead:{attributes:{align:/^(right|left|center|justify)$/,"0":"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},37:"title",tr:{attributes:{align:/^(right|left|center|justify|char)$/,"0":"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},38:"tt",39:"ul",40:"var",41:"section",42:"article",43:"aside",44:"details",45:"header",46:"footer",47:"nav",48:"dialog",49:"figure",50:"figcaption",
51:"address",52:"hgroup",53:"mark",54:"time",55:"canvas",56:"audio",57:"video",58:"source",59:"output",60:"progress",61:"ruby",62:"rt",63:"rp",64:"summary",65:"command"},skiped_attributes:[],skiped_attribute_values:[],getValidTagAttributes:function(a,b){var c={},d=this.getPossibleTagAttributes(a),e;for(e in b){var g=b[e];e=e.toLowerCase();var f=WYMeditor.Helper;!f.contains(this.skiped_attributes,e)&&!f.contains(this.skiped_attribute_values,g)&&("function"!=typeof g&&f.contains(d,e)?this.doesAttributeNeedsValidation(a,
e)?this.validateAttribute(a,e,g)&&(c[e]=g):c[e]=g:jQuery.each(d,function(){this.match(/\/(.*)\//)&&(regex=RegExp(this.match(/\/(.*)\//)[1]),regex.test(e)&&(c[e]=g))}))}return c},getUniqueAttributesAndEventsForTag:function(a){var b=[];if(this._tags[a]&&this._tags[a].attributes)for(var c in this._tags[a].attributes)b.push(parseInt(c,10)==c?this._tags[a].attributes[c]:c);return b},getDefaultAttributesAndEventsForTags:function(){var a=[],b;for(b in this._events)a.push(this._events[b]);for(b in this._attributes)a.push(this._attributes[b]);
return a},isValidTag:function(a){if(this._tags[a])return!0;for(var b in this._tags)if(this._tags[b]==a)return!0;return!1},getDefaultAttributesAndEventsForTag:function(a){var b=[];if(this.isValidTag(a)){var c=this.getDefaultAttributesAndEventsForTags(),d;for(d in c){var e=c[d];if("object"==typeof e){var g=WYMeditor.Helper;if(!(e.except&&g.contains(e.except,a)||e.only&&!g.contains(e.only,a))){var e=e.attributes?e.attributes:e.events,f;for(f in e)b.push("string"!=typeof e[f]?f:e[f])}}}}return b},doesAttributeNeedsValidation:function(a,
b){return this._tags[a]&&(this._tags[a].attributes&&this._tags[a].attributes[b]||this._tags[a].required&&WYMeditor.Helper.contains(this._tags[a].required,b))},validateAttribute:function(a,b,c){return this._tags[a]&&this._tags[a].attributes&&this._tags[a].attributes[b]&&0<c.length&&!c.match(this._tags[a].attributes[b])||this._tags[a]&&this._tags[a].required&&WYMeditor.Helper.contains(this._tags[a].required,b)&&0===c.length?!1:"undefined"!=typeof this._tags[a]},getPossibleTagAttributes:function(a){this._possible_tag_attributes||
(this._possible_tag_attributes={});this._possible_tag_attributes[a]||(this._possible_tag_attributes[a]=this.getUniqueAttributesAndEventsForTag(a).concat(this.getDefaultAttributesAndEventsForTag(a)));return this._possible_tag_attributes[a]}};WYMeditor.ParallelRegex=function(a){this._case=a;this._patterns=[];this._labels=[];this._regex=null;return this};WYMeditor.ParallelRegex.prototype.addPattern=function(a,b){var c=this._patterns.length;this._patterns[c]=a;this._labels[c]=b||!0;this._regex=null};
WYMeditor.ParallelRegex.prototype.match=function(a){if(0===this._patterns.length)return[!1,""];a=a.match(this._getCompoundedRegex());if(!a)return[!1,""];for(var b=a[0],c=1;c<a.length;c++)if(a[c])return[this._labels[c-1],b];return[!0,a[0]]};
WYMeditor.ParallelRegex.prototype._getCompoundedRegex=function(){if(null===this._regex){for(var a=0,b=this._patterns.length;a<b;a++)this._patterns[a]="("+this._untokenizeRegex(this._tokenizeRegex(this._patterns[a]).replace(/([\/\(\)])/g,"\\$1"))+")";this._regex=RegExp(this._patterns.join("|"),this._getPerlMatchingFlags())}return this._regex};
WYMeditor.ParallelRegex.prototype._tokenizeRegex=function(a){return a.replace(/\(\?(i|m|s|x|U)\)/,"~~~~~~Tk1$1~~~~~~").replace(/\(\?(\-[i|m|s|x|U])\)/,"~~~~~~Tk2$1~~~~~~").replace(/\(\?\=(.*)\)/,"~~~~~~Tk3$1~~~~~~").replace(/\(\?\!(.*)\)/,"~~~~~~Tk4$1~~~~~~").replace(/\(\?\<\=(.*)\)/,"~~~~~~Tk5$1~~~~~~").replace(/\(\?\<\!(.*)\)/,"~~~~~~Tk6$1~~~~~~").replace(/\(\?\:(.*)\)/,"~~~~~~Tk7$1~~~~~~")};
WYMeditor.ParallelRegex.prototype._untokenizeRegex=function(a){return a.replace(/~~~~~~Tk1(.{1})~~~~~~/,"(?$1)").replace(/~~~~~~Tk2(.{2})~~~~~~/,"(?$1)").replace(/~~~~~~Tk3(.*)~~~~~~/,"(?=$1)").replace(/~~~~~~Tk4(.*)~~~~~~/,"(?!$1)").replace(/~~~~~~Tk5(.*)~~~~~~/,"(?<=$1)").replace(/~~~~~~Tk6(.*)~~~~~~/,"(?<!$1)").replace(/~~~~~~Tk7(.*)~~~~~~/,"(?:$1)")};WYMeditor.ParallelRegex.prototype._getPerlMatchingFlags=function(){return this._case?"m":"mi"};
WYMeditor.StateStack=function(a){this._stack=[a];return this};WYMeditor.StateStack.prototype.getCurrent=function(){return this._stack[this._stack.length-1]};WYMeditor.StateStack.prototype.enter=function(a){this._stack.push(a)};WYMeditor.StateStack.prototype.leave=function(){if(1==this._stack.length)return!1;this._stack.pop();return!0};WYMeditor.LEXER_ENTER=1;WYMeditor.LEXER_MATCHED=2;WYMeditor.LEXER_UNMATCHED=3;WYMeditor.LEXER_EXIT=4;WYMeditor.LEXER_SPECIAL=5;
WYMeditor.Lexer=function(a,b,c){b=b||"accept";this._case=c||!1;this._regexes={};this._parser=a;this._mode=new WYMeditor.StateStack(b);this._mode_handlers={};this._mode_handlers[b]=b;return this};WYMeditor.Lexer.prototype.addPattern=function(a,b){b=b||"accept";"undefined"==typeof this._regexes[b]&&(this._regexes[b]=new WYMeditor.ParallelRegex(this._case));this._regexes[b].addPattern(a);"undefined"==typeof this._mode_handlers[b]&&(this._mode_handlers[b]=b)};
WYMeditor.Lexer.prototype.addEntryPattern=function(a,b,c){"undefined"==typeof this._regexes[b]&&(this._regexes[b]=new WYMeditor.ParallelRegex(this._case));this._regexes[b].addPattern(a,c);"undefined"==typeof this._mode_handlers[c]&&(this._mode_handlers[c]=c)};
WYMeditor.Lexer.prototype.addExitPattern=function(a,b){"undefined"==typeof this._regexes[b]&&(this._regexes[b]=new WYMeditor.ParallelRegex(this._case));this._regexes[b].addPattern(a,"__exit");"undefined"==typeof this._mode_handlers[b]&&(this._mode_handlers[b]=b)};
WYMeditor.Lexer.prototype.addSpecialPattern=function(a,b,c){"undefined"==typeof this._regexes[b]&&(this._regexes[b]=new WYMeditor.ParallelRegex(this._case));this._regexes[b].addPattern(a,"_"+c);"undefined"==typeof this._mode_handlers[c]&&(this._mode_handlers[c]=c)};WYMeditor.Lexer.prototype.mapHandler=function(a,b){this._mode_handlers[a]=b};
WYMeditor.Lexer.prototype.parse=function(a){if("undefined"==typeof this._parser)return!1;for(var b=a.length,c;"object"==typeof(c=this._reduce(a));){a=c[0];if(!this._dispatchTokens(c[1],c[2],c[3]))return!1;if(""===a)return!0;if(a.length==b)return!1;b=a.length}return!c?!1:this._invokeParser(a,WYMeditor.LEXER_UNMATCHED)};
WYMeditor.Lexer.prototype._dispatchTokens=function(a,b,c){c=c||!1;if(!this._invokeParser(a,WYMeditor.LEXER_UNMATCHED))return!1;if("boolean"==typeof c)return this._invokeParser(b,WYMeditor.LEXER_MATCHED);if(this._isModeEnd(c))return!this._invokeParser(b,WYMeditor.LEXER_EXIT)?!1:this._mode.leave();if(this._isSpecialMode(c))return this._mode.enter(this._decodeSpecial(c)),!this._invokeParser(b,WYMeditor.LEXER_SPECIAL)?!1:this._mode.leave();this._mode.enter(c);return this._invokeParser(b,WYMeditor.LEXER_ENTER)};
WYMeditor.Lexer.prototype._isModeEnd=function(a){return"__exit"===a};WYMeditor.Lexer.prototype._isSpecialMode=function(a){return"_"==a.substring(0,1)};WYMeditor.Lexer.prototype._decodeSpecial=function(a){return a.substring(1)};WYMeditor.Lexer.prototype._invokeParser=function(a,b){if(""===a)return!0;var c=this._mode.getCurrent();return this._parser[this._mode_handlers[c]](a,b)};
WYMeditor.Lexer.prototype._reduce=function(a){var b=this._regexes[this._mode.getCurrent()].match(a),c=b[1];if(b=b[0]){var d=a.indexOf(c),e=a.substr(0,d),a=a.substring(d+c.length);return[a,e,c,b]}return!0};WYMeditor.XhtmlLexer=function(a){jQuery.extend(this,new WYMeditor.Lexer(a,"Text"));this.mapHandler("Text","Text");this.addTokens();this.init();return this};WYMeditor.XhtmlLexer.prototype.init=function(){};
WYMeditor.XhtmlLexer.prototype.addTokens=function(){this.addCommentTokens("Text");this.addScriptTokens("Text");this.addCssTokens("Text");this.addTagTokens("Text")};WYMeditor.XhtmlLexer.prototype.addCommentTokens=function(a){this.addEntryPattern("<\!--",a,"Comment");this.addExitPattern("--\>","Comment")};WYMeditor.XhtmlLexer.prototype.addScriptTokens=function(a){this.addEntryPattern("<script",a,"Script");this.addExitPattern("<\/script>","Script")};
WYMeditor.XhtmlLexer.prototype.addCssTokens=function(a){this.addEntryPattern("<style",a,"Css");this.addExitPattern("</style>","Css")};WYMeditor.XhtmlLexer.prototype.addTagTokens=function(a){this.addSpecialPattern("<\\s*[a-z0-9:-]+\\s*>",a,"OpeningTag");this.addEntryPattern("<[a-z0-9:-]+[\\/ \\>]+",a,"OpeningTag");this.addInTagDeclarationTokens("OpeningTag");this.addSpecialPattern("</\\s*[a-z0-9:-]+\\s*>",a,"ClosingTag")};
WYMeditor.XhtmlLexer.prototype.addInTagDeclarationTokens=function(a){this.addSpecialPattern("\\s+",a,"Ignore");this.addAttributeTokens(a);this.addExitPattern("/>",a);this.addExitPattern(">",a)};
WYMeditor.XhtmlLexer.prototype.addAttributeTokens=function(a){this.addSpecialPattern("\\s*[a-z-_0-9]*:?[a-z-_0-9]+\\s*(?==)\\s*",a,"TagAttributes");this.addEntryPattern('=\\s*"',a,"DoubleQuotedAttribute");this.addPattern('\\\\"',"DoubleQuotedAttribute");this.addExitPattern('"',"DoubleQuotedAttribute");this.addEntryPattern("=\\s*'",a,"SingleQuotedAttribute");this.addPattern("\\\\'","SingleQuotedAttribute");this.addExitPattern("'","SingleQuotedAttribute");this.addSpecialPattern("=\\s*[^>\\s]*",a,"UnquotedAttribute")};
WYMeditor.XhtmlParser=function(a,b){b=b||"Text";this._Lexer=new WYMeditor.XhtmlLexer(this);this._Listener=a;this._mode=b;this._matches=[];this._current_match=this._last_match="";return this};WYMeditor.XhtmlParser.prototype.parse=function(a){this._Lexer.parse(this.beforeParsing(a));return this.afterParsing(this._Listener.getResult())};
WYMeditor.XhtmlParser.prototype.beforeParsing=function(a){(a.match(/class="MsoNormal"/)||a.match(/ns = "urn:schemas-microsoft-com/))&&this._Listener.avoidStylingTagsAndAttributes();return this._Listener.beforeParsing(a)};WYMeditor.XhtmlParser.prototype.afterParsing=function(a){this._Listener._avoiding_tags_implicitly&&this._Listener.allowStylingTagsAndAttributes();return this._Listener.afterParsing(a)};WYMeditor.XhtmlParser.prototype.Ignore=function(){return!0};
WYMeditor.XhtmlParser.prototype.Text=function(a){this._Listener.addContent(a);return!0};WYMeditor.XhtmlParser.prototype.Comment=function(a,b){return this._addNonTagBlock(a,b,"addComment")};WYMeditor.XhtmlParser.prototype.Script=function(a,b){return this._addNonTagBlock(a,b,"addScript")};WYMeditor.XhtmlParser.prototype.Css=function(a,b){return this._addNonTagBlock(a,b,"addCss")};
WYMeditor.XhtmlParser.prototype._addNonTagBlock=function(a,b,c){switch(b){case WYMeditor.LEXER_ENTER:this._non_tag=a;break;case WYMeditor.LEXER_UNMATCHED:this._non_tag+=a;break;case WYMeditor.LEXER_EXIT:switch(c){case "addComment":this._Listener.addComment(this._non_tag+a);break;case "addScript":this._Listener.addScript(this._non_tag+a);break;case "addCss":this._Listener.addCss(this._non_tag+a)}}return!0};
WYMeditor.XhtmlParser.prototype.OpeningTag=function(a,b){switch(b){case WYMeditor.LEXER_ENTER:this._tag=this.normalizeTag(a);this._tag_attributes={};break;case WYMeditor.LEXER_SPECIAL:this._callOpenTagListener(this.normalizeTag(a));break;case WYMeditor.LEXER_EXIT:this._callOpenTagListener(this._tag,this._tag_attributes)}return!0};WYMeditor.XhtmlParser.prototype.ClosingTag=function(a){this._callCloseTagListener(this.normalizeTag(a));return!0};
WYMeditor.XhtmlParser.prototype._callOpenTagListener=function(a,b){b=b||{};this.autoCloseUnclosedBeforeNewOpening(a);this._Listener.isBlockTag(a)?(this._Listener._tag_stack.push(a),this._Listener.fixNestingBeforeOpeningBlockTag(a,b),this._Listener.openBlockTag(a,b),this._increaseOpenTagCounter(a)):this._Listener.isInlineTag(a)?this._Listener.inlineTag(a,b):(this._Listener.openUnknownTag(a,b),this._increaseOpenTagCounter(a));this._Listener.last_tag=a;this._Listener.last_tag_opened=!0;this._Listener.last_tag_attributes=
b};WYMeditor.XhtmlParser.prototype._callCloseTagListener=function(a){if(this._decreaseOpenTagCounter(a))if(this.autoCloseUnclosedBeforeTagClosing(a),this._Listener.isBlockTag(a)){var b=this._Listener._tag_stack.pop();if(!1===b)return;b!=a&&(a=b);this._Listener.closeBlockTag(a)}else this._Listener.closeUnknownTag(a);else this._Listener.closeUnopenedTag(a);this._Listener.last_tag=a;this._Listener.last_tag_opened=!1};
WYMeditor.XhtmlParser.prototype._increaseOpenTagCounter=function(a){this._Listener._open_tags[a]=this._Listener._open_tags[a]||0;this._Listener._open_tags[a]++};WYMeditor.XhtmlParser.prototype._decreaseOpenTagCounter=function(a){return this._Listener._open_tags[a]?(this._Listener._open_tags[a]--,0===this._Listener._open_tags[a]&&(this._Listener._open_tags[a]=void 0),!0):!1};WYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeNewOpening=function(a){this._autoCloseUnclosed(a,!1)};
WYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeTagClosing=function(a){this._autoCloseUnclosed(a,!0)};WYMeditor.XhtmlParser.prototype._autoCloseUnclosed=function(a,b){b=b||!1;if(this._Listener._open_tags)for(var c in this._Listener._open_tags)0<this._Listener._open_tags[c]&&this._Listener.shouldCloseTagAutomatically(c,a,b)&&this._callCloseTagListener(c,!0)};WYMeditor.XhtmlParser.prototype.getTagReplacements=function(){return this._Listener.getTagReplacements()};
WYMeditor.XhtmlParser.prototype.normalizeTag=function(a){var a=a.replace(/^([\s<\/>]*)|([\s<\/>]*)$/gm,"").toLowerCase(),b=this._Listener.getTagReplacements();return b[a]?b[a]:a};WYMeditor.XhtmlParser.prototype.TagAttributes=function(a,b){WYMeditor.LEXER_SPECIAL==b&&(this._current_attribute=a);return!0};WYMeditor.XhtmlParser.prototype.DoubleQuotedAttribute=function(a,b){WYMeditor.LEXER_UNMATCHED==b&&(this._tag_attributes[this._current_attribute]=a);return!0};
WYMeditor.XhtmlParser.prototype.SingleQuotedAttribute=function(a,b){WYMeditor.LEXER_UNMATCHED==b&&(this._tag_attributes[this._current_attribute]=a);return!0};WYMeditor.XhtmlParser.prototype.UnquotedAttribute=function(a){this._tag_attributes[this._current_attribute]=a.replace(/^=/,"");return!0};
WYMeditor.XhtmlSaxListener=function(){this.output="";this.helper=new WYMeditor.XmlHelper;this._open_tags={};this.validator=WYMeditor.XhtmlValidator;this._tag_stack=[];this.avoided_tags=[];this._insert_before_closing=[];this._insert_after_closing=[];this._last_node_was_text=!1;this.entities={"&nbsp;":"&#160;","&iexcl;":"&#161;","&cent;":"&#162;","&pound;":"&#163;","&curren;":"&#164;","&yen;":"&#165;","&brvbar;":"&#166;","&sect;":"&#167;","&uml;":"&#168;","&copy;":"&#169;","&ordf;":"&#170;","&laquo;":"&#171;",
"&not;":"&#172;","&shy;":"&#173;","&reg;":"&#174;","&macr;":"&#175;","&deg;":"&#176;","&plusmn;":"&#177;","&sup2;":"&#178;","&sup3;":"&#179;","&acute;":"&#180;","&micro;":"&#181;","&para;":"&#182;","&middot;":"&#183;","&cedil;":"&#184;","&sup1;":"&#185;","&ordm;":"&#186;","&raquo;":"&#187;","&frac14;":"&#188;","&frac12;":"&#189;","&frac34;":"&#190;","&iquest;":"&#191;","&Agrave;":"&#192;","&Aacute;":"&#193;","&Acirc;":"&#194;","&Atilde;":"&#195;","&Auml;":"&#196;","&Aring;":"&#197;","&AElig;":"&#198;",
"&Ccedil;":"&#199;","&Egrave;":"&#200;","&Eacute;":"&#201;","&Ecirc;":"&#202;","&Euml;":"&#203;","&Igrave;":"&#204;","&Iacute;":"&#205;","&Icirc;":"&#206;","&Iuml;":"&#207;","&ETH;":"&#208;","&Ntilde;":"&#209;","&Ograve;":"&#210;","&Oacute;":"&#211;","&Ocirc;":"&#212;","&Otilde;":"&#213;","&Ouml;":"&#214;","&times;":"&#215;","&Oslash;":"&#216;","&Ugrave;":"&#217;","&Uacute;":"&#218;","&Ucirc;":"&#219;","&Uuml;":"&#220;","&Yacute;":"&#221;","&THORN;":"&#222;","&szlig;":"&#223;","&agrave;":"&#224;",
"&aacute;":"&#225;","&acirc;":"&#226;","&atilde;":"&#227;","&auml;":"&#228;","&aring;":"&#229;","&aelig;":"&#230;","&ccedil;":"&#231;","&egrave;":"&#232;","&eacute;":"&#233;","&ecirc;":"&#234;","&euml;":"&#235;","&igrave;":"&#236;","&iacute;":"&#237;","&icirc;":"&#238;","&iuml;":"&#239;","&eth;":"&#240;","&ntilde;":"&#241;","&ograve;":"&#242;","&oacute;":"&#243;","&ocirc;":"&#244;","&otilde;":"&#245;","&ouml;":"&#246;","&divide;":"&#247;","&oslash;":"&#248;","&ugrave;":"&#249;","&uacute;":"&#250;",
"&ucirc;":"&#251;","&uuml;":"&#252;","&yacute;":"&#253;","&thorn;":"&#254;","&yuml;":"&#255;","&OElig;":"&#338;","&oelig;":"&#339;","&Scaron;":"&#352;","&scaron;":"&#353;","&Yuml;":"&#376;","&fnof;":"&#402;","&circ;":"&#710;","&tilde;":"&#732;","&Alpha;":"&#913;","&Beta;":"&#914;","&Gamma;":"&#915;","&Delta;":"&#916;","&Epsilon;":"&#917;","&Zeta;":"&#918;","&Eta;":"&#919;","&Theta;":"&#920;","&Iota;":"&#921;","&Kappa;":"&#922;","&Lambda;":"&#923;","&Mu;":"&#924;","&Nu;":"&#925;","&Xi;":"&#926;","&Omicron;":"&#927;",
"&Pi;":"&#928;","&Rho;":"&#929;","&Sigma;":"&#931;","&Tau;":"&#932;","&Upsilon;":"&#933;","&Phi;":"&#934;","&Chi;":"&#935;","&Psi;":"&#936;","&Omega;":"&#937;","&alpha;":"&#945;","&beta;":"&#946;","&gamma;":"&#947;","&delta;":"&#948;","&epsilon;":"&#949;","&zeta;":"&#950;","&eta;":"&#951;","&theta;":"&#952;","&iota;":"&#953;","&kappa;":"&#954;","&lambda;":"&#955;","&mu;":"&#956;","&nu;":"&#957;","&xi;":"&#958;","&omicron;":"&#959;","&pi;":"&#960;","&rho;":"&#961;","&sigmaf;":"&#962;","&sigma;":"&#963;",
"&tau;":"&#964;","&upsilon;":"&#965;","&phi;":"&#966;","&chi;":"&#967;","&psi;":"&#968;","&omega;":"&#969;","&thetasym;":"&#977;","&upsih;":"&#978;","&piv;":"&#982;","&ensp;":"&#8194;","&emsp;":"&#8195;","&thinsp;":"&#8201;","&zwnj;":"&#8204;","&zwj;":"&#8205;","&lrm;":"&#8206;","&rlm;":"&#8207;","&ndash;":"&#8211;","&mdash;":"&#8212;","&lsquo;":"&#8216;","&rsquo;":"&#8217;","&sbquo;":"&#8218;","&ldquo;":"&#8220;","&rdquo;":"&#8221;","&bdquo;":"&#8222;","&dagger;":"&#8224;","&Dagger;":"&#8225;","&bull;":"&#8226;",
"&hellip;":"&#8230;","&permil;":"&#8240;","&prime;":"&#8242;","&Prime;":"&#8243;","&lsaquo;":"&#8249;","&rsaquo;":"&#8250;","&oline;":"&#8254;","&frasl;":"&#8260;","&euro;":"&#8364;","&image;":"&#8465;","&weierp;":"&#8472;","&real;":"&#8476;","&trade;":"&#8482;","&alefsym;":"&#8501;","&larr;":"&#8592;","&uarr;":"&#8593;","&rarr;":"&#8594;","&darr;":"&#8595;","&harr;":"&#8596;","&crarr;":"&#8629;","&lArr;":"&#8656;","&uArr;":"&#8657;","&rArr;":"&#8658;","&dArr;":"&#8659;","&hArr;":"&#8660;","&forall;":"&#8704;",
"&part;":"&#8706;","&exist;":"&#8707;","&empty;":"&#8709;","&nabla;":"&#8711;","&isin;":"&#8712;","&notin;":"&#8713;","&ni;":"&#8715;","&prod;":"&#8719;","&sum;":"&#8721;","&minus;":"&#8722;","&lowast;":"&#8727;","&radic;":"&#8730;","&prop;":"&#8733;","&infin;":"&#8734;","&ang;":"&#8736;","&and;":"&#8743;","&or;":"&#8744;","&cap;":"&#8745;","&cup;":"&#8746;","&int;":"&#8747;","&there4;":"&#8756;","&sim;":"&#8764;","&cong;":"&#8773;","&asymp;":"&#8776;","&ne;":"&#8800;","&equiv;":"&#8801;","&le;":"&#8804;",
"&ge;":"&#8805;","&sub;":"&#8834;","&sup;":"&#8835;","&nsub;":"&#8836;","&sube;":"&#8838;","&supe;":"&#8839;","&oplus;":"&#8853;","&otimes;":"&#8855;","&perp;":"&#8869;","&sdot;":"&#8901;","&lceil;":"&#8968;","&rceil;":"&#8969;","&lfloor;":"&#8970;","&rfloor;":"&#8971;","&lang;":"&#9001;","&rang;":"&#9002;","&loz;":"&#9674;","&spades;":"&#9824;","&clubs;":"&#9827;","&hearts;":"&#9829;","&diams;":"&#9830;"};this.block_tags="a abbr acronym address area b base bdo big blockquote body button caption cite code colgroup dd del div dfn dl dt em fieldset form head h1 h2 h3 h4 h5 h6 html i ins kbd label legend li map noscript object ol optgroup option p param pre q samp script select small span strong style sub sup table tbody td textarea tfoot th thead title tr tt ul var extends meter section article aside details header footer nav dialog figure figcaption address hgroup mark time canvas audio video source output progress ruby rt rp summary command".split(" ");
this.inline_tags=["br","col","hr","img","input"];return this};WYMeditor.XhtmlSaxListener.prototype.shouldCloseTagAutomatically=function(a,b,c){c=c||!1;if("td"==a){if(c&&"tr"==b||!c&&"td"==b)return!0}else if("option"==a&&(c&&"select"==b||!c&&"option"==b))return!0;return!1};WYMeditor.XhtmlSaxListener.prototype.beforeParsing=function(a){this.output="";this._insert_before_closing=[];this._insert_after_closing=[];this._open_tags={};this._tag_stack=[];this._last_node_was_text=!1;this.last_tag=null;return a};
WYMeditor.XhtmlSaxListener.prototype.afterParsing=function(a){a=this.replaceNamedEntities(a);a=this.joinRepeatedEntities(a);a=this.removeEmptyTags(a);return a=this.removeBrInPre(a)};WYMeditor.XhtmlSaxListener.prototype.replaceNamedEntities=function(a){for(var b in this.entities)a=a.replace(RegExp(b,"g"),this.entities[b]);return a};
WYMeditor.XhtmlSaxListener.prototype.joinRepeatedEntities=function(a){return a.replace(/<\/(em|strong|sub|sup|acronym|pre|del|address)><\1>/,"").replace(/(s*<(em|strong|sub|sup|acronym|pre|del|address)>s*){2}(.*)(s*<\/\2>s*){2}/,"<$2>$3<$2>")};WYMeditor.XhtmlSaxListener.prototype.removeEmptyTags=function(a){return a.replace(RegExp("<("+this.block_tags.join("|").replace(/\|td/,"").replace(/\|th/,"")+")>(<br />|&#160;|&nbsp;|\\s)*</\\1>","g"),"")};
WYMeditor.XhtmlSaxListener.prototype.removeBrInPre=function(a){var b=a.match(RegExp("<pre[^>]*>(.*?)</pre>","gmi"));if(b)for(var c=0;c<b.length;c++)a=a.replace(b[c],b[c].replace(RegExp("<br />","g"),String.fromCharCode(13,10)));return a};WYMeditor.XhtmlSaxListener.prototype.getResult=function(){return this.output};WYMeditor.XhtmlSaxListener.prototype.getTagReplacements=function(){return{b:"strong",i:"em"}};
WYMeditor.XhtmlSaxListener.prototype.addContent=function(a){this.last_tag&&"li"==this.last_tag&&(a=a.replace(/(\r|\n|\r\n)+$/g,""),a=a.replace(/(\r|\n|\r\n)+/g," "));0<a.replace(/^\s+|\s+$/g,"").length&&(this._last_node_was_text=!0);this.output+=a};WYMeditor.XhtmlSaxListener.prototype.addComment=function(a){this.remove_comments&&(this.output+=a)};WYMeditor.XhtmlSaxListener.prototype.addScript=function(a){this.remove_scripts||(this.output+=a)};
WYMeditor.XhtmlSaxListener.prototype.addCss=function(a){this.remove_embeded_styles||(this.output+=a)};WYMeditor.XhtmlSaxListener.prototype.openBlockTag=function(a,b){this._last_node_was_text=!1;this.output+=this.helper.tag(a,this.validator.getValidTagAttributes(a,b),!0)};WYMeditor.XhtmlSaxListener.prototype.inlineTag=function(a,b){this._last_node_was_text=!1;this.output+=this.helper.tag(a,this.validator.getValidTagAttributes(a,b))};WYMeditor.XhtmlSaxListener.prototype.openUnknownTag=function(){};
WYMeditor.XhtmlSaxListener.prototype.closeBlockTag=function(a){this._last_node_was_text=!1;this.output=this.output.replace(/<br \/>$/,"")+this._getClosingTagContent("before",a)+"</"+a+">"+this._getClosingTagContent("after",a)};WYMeditor.XhtmlSaxListener.prototype.closeUnknownTag=function(){};WYMeditor.XhtmlSaxListener.prototype.closeUnopenedTag=function(a){this._last_node_was_text=!1;this.output+="</"+a+">"};
WYMeditor.XhtmlSaxListener.prototype.avoidStylingTagsAndAttributes=function(){this.avoided_tags=["div","span"];this.validator.skiped_attributes=["style"];this.validator.skiped_attribute_values=["MsoNormal","main1"];this._avoiding_tags_implicitly=!0};WYMeditor.XhtmlSaxListener.prototype.allowStylingTagsAndAttributes=function(){this.avoided_tags=[];this.validator.skiped_attributes=[];this.validator.skiped_attribute_values=[];this._avoiding_tags_implicitly=!1};
WYMeditor.XhtmlSaxListener.prototype.isBlockTag=function(a){return!WYMeditor.Helper.contains(this.avoided_tags,a)&&WYMeditor.Helper.contains(this.block_tags,a)};WYMeditor.XhtmlSaxListener.prototype.isInlineTag=function(a){return!WYMeditor.Helper.contains(this.avoided_tags,a)&&WYMeditor.Helper.contains(this.inline_tags,a)};WYMeditor.XhtmlSaxListener.prototype.insertContentAfterClosingTag=function(a,b){this._insertContentWhenClosingTag("after",a,b)};
WYMeditor.XhtmlSaxListener.prototype.insertContentBeforeClosingTag=function(a,b){this._insertContentWhenClosingTag("before",a,b)};
WYMeditor.XhtmlSaxListener.prototype.fixNestingBeforeOpeningBlockTag=function(a){!this._last_node_was_text&&("ul"==a||"ol"==a)&&this.last_tag&&!this.last_tag_opened&&"li"==this.last_tag?(this.output=this.output.replace(/<\/li>\s*$/,""),this.insertContentAfterClosingTag(a,"</li>")):("ul"==a||"ol"==a)&&this.last_tag&&this.last_tag_opened&&("ul"==this.last_tag||"ol"==this.last_tag)?(this._last_node_was_text=!1,this.output+=this.helper.tag("li",{},!0),this.insertContentAfterClosingTag(a,"</li>")):"li"==
a&&!this.last_tag_opened&&(2<=this._tag_stack.length&&"li"==this._tag_stack[this._tag_stack.length-2])&&(this._open_tags.li-=1,0===this._open_tags.li&&(this._open_tags.li=void 0),this._tag_stack.pop(this._tag_stack.length-2),this._last_node_was_text=!1,this.output+="</li>")};
WYMeditor.XhtmlSaxListener.prototype._insertContentWhenClosingTag=function(a,b,c){this["_insert_"+a+"_closing"]||(this["_insert_"+a+"_closing"]=[]);this["_insert_"+a+"_closing"][b]||(this["_insert_"+a+"_closing"][b]=[]);this["_insert_"+a+"_closing"][b].push(c)};WYMeditor.XhtmlSaxListener.prototype._getClosingTagContent=function(a,b){return this["_insert_"+a+"_closing"]&&this["_insert_"+a+"_closing"][b]&&0<this["_insert_"+a+"_closing"][b].length?this["_insert_"+a+"_closing"][b].pop():""};
WYMeditor.WymCssLexer=function(a,b){b="undefined"==typeof b?!0:b;jQuery.extend(this,new WYMeditor.Lexer(a,b?"Ignore":"WymCss"));this.mapHandler("WymCss","Ignore");!0===b&&(this.addEntryPattern("/\\*[<\\s]*WYMeditor[>\\s]*\\*/","Ignore","WymCss"),this.addExitPattern("/\\*[</\\s]*WYMeditor[>\\s]*\\*/","WymCss"));this.addSpecialPattern("[\\sa-z1-6]*\\.[a-z-_0-9]+","WymCss","WymCssStyleDeclaration");this.addEntryPattern("/\\*","WymCss","WymCssComment");this.addExitPattern("\\*/","WymCssComment");this.addEntryPattern("{",
"WymCss","WymCssStyle");this.addExitPattern("}","WymCssStyle");this.addEntryPattern("/\\*","WymCssStyle","WymCssFeedbackStyle");this.addExitPattern("\\*/","WymCssFeedbackStyle");return this};WYMeditor.WymCssParser=function(){this._has_title=this._in_style=!1;this.only_wym_blocks=!0;this.css_settings={classesItems:[],editorStyles:[],dialogStyles:[]};return this};
WYMeditor.WymCssParser.prototype.parse=function(a,b){b="undefined"==typeof b?this.only_wym_blocks:b;this._Lexer=new WYMeditor.WymCssLexer(this,b);this._Lexer.parse(a)};WYMeditor.WymCssParser.prototype.Ignore=function(){return!0};
WYMeditor.WymCssParser.prototype.WymCssComment=function(a,b){if(a.match(/end[a-z0-9\s]*wym[a-z0-9\s]*/mi))return!1;b==WYMeditor.LEXER_UNMATCHED&&(this._in_style?this._current_item[this._current_element]&&(this._current_item[this._current_element].expressions?this._current_item[this._current_element].expressions.push(a):this._current_item[this._current_element].expressions=[a]):(this._has_title=!0,this._current_item={title:WYMeditor.Helper.trim(a)}),this._in_style=!0);return!0};
WYMeditor.WymCssParser.prototype.WymCssStyle=function(a,b){b==WYMeditor.LEXER_UNMATCHED?(a=WYMeditor.Helper.trim(a),""!==a&&(this._current_item[this._current_element].style=a)):b==WYMeditor.LEXER_EXIT&&(this._has_title=this._in_style=!1,this.addStyleSetting(this._current_item));return!0};WYMeditor.WymCssParser.prototype.WymCssFeedbackStyle=function(a,b){b==WYMeditor.LEXER_UNMATCHED&&(this._current_item[this._current_element].feedback_style=a.replace(/^([\s\/\*]*)|([\s\/\*]*)$/gm,""));return!0};
WYMeditor.WymCssParser.prototype.WymCssStyleDeclaration=function(a){var a=a.replace(/^([\s\.]*)|([\s\.*]*)$/gm,""),b="";0<a.indexOf(".")?(a=a.split("."),this._current_element=a[1],b=a[0]):this._current_element=a;this._has_title||(this._current_item={title:(!b?"":b.toUpperCase()+": ")+this._current_element},this._has_title=!0);this._current_item[this._current_element]||(this._current_item[this._current_element]={name:this._current_element});b&&(this._current_item[this._current_element].tags?this._current_item[this._current_element].tags.push(b):
this._current_item[this._current_element].tags=[b]);return!0};
WYMeditor.WymCssParser.prototype.addStyleSetting=function(a){for(var b in a){var c=a[b];"object"==typeof c&&"title"!=b&&(this.css_settings.classesItems.push({name:WYMeditor.Helper.trim(c.name),title:a.title,expr:WYMeditor.Helper.trim((c.expressions||c.tags).join(", "))}),c.feedback_style&&this.css_settings.editorStyles.push({name:"."+WYMeditor.Helper.trim(c.name),css:c.feedback_style}),c.style&&this.css_settings.dialogStyles.push({name:"."+WYMeditor.Helper.trim(c.name),css:c.style}))}};
